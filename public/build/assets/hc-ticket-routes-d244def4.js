import{j as e,T as n,a3 as w,a4 as z,k as p,U as T,B as S,z as V,a2 as B,g as G,r as d,E as U,ai as Y,m as C,S as W,y as E,bj as X,n as b,F as H,G as J,M as N,u as M,s as Z,a5 as ee,a6 as D,t as se,v as O,au as te,an as $,K as ae,al as ne,D as ie,w as re,ae as ce,O as oe,b as K,i as le,A as de,aw as me,h as ue,aF as xe,ax as he,aH as ge,aG as je,X as pe,a1 as fe}from"./main-030e7994.js";import{H as I}from"./hc-routes-8c86cf34.js";import{a as be,S as ye,l as Se,f as ve,c as ke,T as Ne,I as we,u as Te,k as Ce}from"./use-create-ticket-191d1327.js";import{T as Ie,D as Pe,a as qe,R as Q,A as Re,F as Fe,j as Ae,x as L,g as _e}from"./reply-editor-14b4a609.js";import{s as Le}from"./search-a7f8797c.js";import{B as P,a as h}from"./breadcrumb-c42a2610.js";import{R as ze}from"./Reply-62b0d6b5.js";import{u as Be}from"./search-trigger-button-b4d0fbfb.js";import{S as Ee}from"./section-helper-85d2074f.js";import"./bullet-seprated-items-a08505c8.js";import"./AttachFile-3537f9b5.js";import"./Edit-db079bb8.js";const He=[{key:"subject",visibleInMode:"all",header:()=>e.jsx(n,{message:"Subject"}),body:s=>s.subject,width:"flex-3 min-w-200"},{key:"id",allowsSorting:!0,header:()=>e.jsx(n,{message:"Id"}),width:"w-90",body:s=>`#${s.id}`},{key:"Created",allowsSorting:!0,header:()=>e.jsx(n,{message:"Created"}),width:"w-144",body:s=>e.jsx(w,{date:s.created_at})},{key:"updated_at",allowsSorting:!0,header:()=>e.jsx(n,{message:"Last updated"}),width:"w-144",body:s=>e.jsx(w,{date:s.updated_at})},{key:"status",header:()=>e.jsx(n,{message:"Status"}),visibleInMode:"all",width:"w-80",body:s=>e.jsx("div",{className:"w-max",children:e.jsx(z,{size:"sm",color:s.closed_at?void 0:"primary",radius:"rounded-md",className:"font-medium capitalize",children:e.jsx(n,{message:s.status})})})}],Me="1",De="20";function Oe(){const s=p();return e.jsxs("div",{children:[e.jsx(T,{menuPosition:"header",children:e.jsx(I,{})}),e.jsxs("main",{className:"container mx-auto px-24 pb-48",children:[e.jsxs(P,{size:"sm",className:"mb-48 mt-34",children:[e.jsx(h,{onSelected:()=>s("/hc"),children:e.jsx(n,{message:"Help center"})}),e.jsx(h,{onSelected:()=>s("/hc/tickets"),children:e.jsx(n,{message:"Requests"})})]}),e.jsxs("div",{className:"mb-34 flex items-start justify-between gap-12",children:[e.jsx("h1",{className:"text-3xl font-semibold",children:e.jsx(n,{message:"My requests"})}),e.jsx(S,{elementType:V,to:"/hc/tickets/new",size:"sm",variant:"outline",children:e.jsx(n,{message:"New request"})})]}),e.jsx($e,{})]})]})}function $e(){var y,f;const[s,t]=B(),{trans:a}=G(),i=d.useRef(null),u=p(),{user:r}=U(),c=be({userId:r.id,query:s.get("query"),tagId:s.get("tagId"),page:s.get("page")||Me,perPage:s.get("perPage")||De}),g=((f=(y=c.data)==null?void 0:y.pagination)==null?void 0:f.data)||[],x=!!s.get("query")||!!s.get("tagId"),j=()=>{t(m=>{var l;return(l=i.current)!=null&&l.value?m.set("query",i.current.value):m.delete("query"),m})},v=g.length?e.jsxs(d.Fragment,{children:[e.jsx(Ie,{columns:He,data:g,enableSelection:!1,onAction:m=>u(`/hc/tickets/${m.id}`),cellHeight:"h-60"}),e.jsx(Pe,{className:"mt-12",query:c,onPageChange:m=>t(l=>(l.set("page",m.toString()),l))})]}):e.jsx(Ke,{isFiltering:x});return e.jsxs(d.Fragment,{children:[e.jsxs("form",{className:"mb-34 items-end justify-between gap-24 md:flex",onSubmit:m=>{m.preventDefault(),j()},children:[e.jsx(Y,{className:"flex-auto max-md:mb-24",inputRef:i,defaultValue:s.get("query")||"",onBlur:()=>j(),placeholder:a(C("Search requests")),startAdornment:e.jsx(W,{})}),e.jsx(Qe,{})]}),e.jsx(E,{initial:!1,mode:"wait",children:c.isLoading?e.jsx(Ve,{}):v})]})}function Ke({isFiltering:s}){return e.jsx(qe,{isFiltering:s,size:"sm",className:"mt-48",image:Le,title:e.jsx(n,{message:"You have not created any requests yet"}),filteringTitle:e.jsx(n,{message:"No requests match your search query or filters"})})}function Qe(){const[s,t]=B();return e.jsxs(X,{className:"flex-shrink-0 md:min-w-172",selectionMode:"single",selectedValue:s.get("tagId")||"",onSelectionChange:a=>{t(i=>(a?i.set("tagId",`${a}`):i.delete("tagId"),i))},children:[e.jsx(b,{value:"",children:e.jsx(n,{message:"All requests"})}),e.jsx(b,{value:"open",children:e.jsx(n,{message:"Open requests"})}),e.jsx(b,{value:"closed",children:e.jsx(n,{message:"Closed requests"})}),e.jsx(b,{value:"pending",children:e.jsx(n,{message:"Awaiting your reply"})})]})}function Ve(){return e.jsxs(H.div,{...J,children:[e.jsx(N,{size:"h-36",variant:"rect",className:"mb-12"}),e.jsx(N,{size:"h-54",variant:"rect",className:"mb-12"}),e.jsx(N,{size:"h-54",variant:"rect"})]},"skeletons")}function Ge(){const{ticketId:s}=M();return Z({mutationFn:t=>Ue({ticketId:s,...t}),onSuccess:async()=>{await ee.invalidateQueries({queryKey:["tickets"]}),D(C("Reply submitted"))},onError:t=>se(t)})}function Ue(s){var a;const t={body:s.body,attachments:(a=s.attachments)==null?void 0:a.map(i=>i.id)};return O.post(`tickets/${s.ticketId}/replies`,t).then(i=>i.data)}function Ye(){const s=p();return e.jsxs("div",{children:[e.jsx(T,{menuPosition:"header",children:e.jsx(I,{})}),e.jsxs("div",{className:"container mx-auto px-12 pb-48 md:px-24",children:[e.jsxs(P,{size:"sm",className:"mb-34 mt-34 md:mb-48",children:[e.jsx(h,{onSelected:()=>s("/hc"),children:e.jsx(n,{message:"Help center"})}),e.jsx(h,{onSelected:()=>s("/hc/tickets"),children:e.jsx(n,{message:"Requests"})}),e.jsx(h,{children:e.jsx(n,{message:"Current ticket"})})]}),e.jsx("main",{children:e.jsx(We,{})})]})]})}function We(){const s=te(),[t,a]=d.useState(!1);return Be("window","r",()=>a(!0)),e.jsx(d.Fragment,{children:s.data?e.jsxs(d.Fragment,{children:[s.data.ticket.status==="locked"&&e.jsx(Ee,{className:"mb-44 text-center",color:"danger",title:e.jsx(n,{message:"This ticket was locked due to inactivity. To reply, create a new ticket."})}),e.jsx(Je,{ticket:s.data.ticket,editorIsOpen:t,onOpenEditor:()=>a(!0)}),e.jsx($,{children:t&&e.jsx(Xe,{onClose:()=>a(!1)})}),e.jsx(Ze,{data:s.data})]}):e.jsx(ae,{query:s,loaderClassName:"absolute inset-0 m-auto"})})}function Xe({onClose:s}){const t=d.useRef(null),a=Ge(),[i,u]=d.useState([]);return e.jsx(Q,{isLoading:a.isPending,footerButtons:e.jsx(ye,{}),editorRef:t,className:"mb-24",attachments:i,onAttachmentsChange:r=>u(r),onSubmit:r=>a.mutate(r,{onSuccess:()=>s()})})}function Je({ticket:s,onOpenEditor:t,editorIsOpen:a}){return e.jsxs("div",{className:"mb-44",children:[e.jsxs("div",{className:"flex items-center gap-24",children:[e.jsxs("div",{className:"whitespace-nowrap text-muted max-md:hidden",children:[e.jsx(w,{date:s.created_at})," (",e.jsx(ne,{date:s.created_at,options:Se}),")"]}),e.jsxs("div",{className:"text-2xl md:ml-auto",children:["#",s.id]}),e.jsx(z,{size:"sm",color:s.closed_at?void 0:"primary",radius:"rounded",className:"min-w-60 font-bold capitalize",children:s.status})]}),e.jsx("h1",{className:"my-12 text-2xl",children:s.subject}),e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx(ve,{ticket:s,tagType:"category",size:"sm",radius:"rounded",className:"mr-auto font-semibold max-md:hidden"}),!s.closed_at&&e.jsx(ss,{}),e.jsx(S,{size:"sm",variant:"outline",startIcon:e.jsx(ze,{}),disabled:a,onClick:()=>t(),children:e.jsx(n,{message:"Add a reply"})})]})]})}function Ze({data:{ticket:s,replies:t}}){const a=ke(s.id,t);return e.jsxs(d.Fragment,{children:[a.items.map(i=>{var r,c;const u=!a.hasNextPage&&i.id===((r=a.items.at(-1))==null?void 0:r.id);return e.jsx(Ne,{className:"px-12",reply:i,isInitial:u,attachments:(c=i.attachments)!=null&&c.length?e.jsx(es,{attachments:i.attachments}):null},i.id)}),e.jsx(we,{query:a})]})}function es({attachments:s}){return e.jsx(Re,{className:"mt-30 w-max",children:s.map((t,a)=>e.jsx(Fe,{attachments:s,index:a},t.id))})}function ss(){const s=Te(),{ticketId:t}=M(),a=p();return e.jsxs(ie,{type:"modal",children:[e.jsx(S,{size:"sm",variant:"outline",startIcon:e.jsx(re,{}),children:e.jsx(n,{message:"Mark as solved"})}),({close:i})=>e.jsx(ce,{onConfirm:()=>{s.mutate({ids:[t],status:"closed"},{onSuccess:()=>{i(),D(C("Ticked marked as solved")),a("/hc/tickets")}})},isLoading:s.isPending,title:e.jsx(n,{message:"Mark as solved"}),body:e.jsx(n,{message:"Are you sure you want to mark this ticket as solved?"}),confirm:e.jsx(n,{message:"Confirm"})})]})}function ts(){return oe({queryKey:["new-ticket-categories"],queryFn:()=>as()})}function as(){return O.get("ticket-categories",{params:{perPage:25,with:"categories",orderBy:"name",orderDir:"asc",filterByPurchases:!0,paginate:"simple"}}).then(s=>s.data)}function q(){var t,a;return((a=(t=K().hc)==null?void 0:t.newTicket)==null?void 0:a.appearance)||{}}function ns({query:s,suggestionLog:t,hcCategoryIds:a}){const i=Ae(),u=x=>{x.pagination.data.length&&t.current.push({term:x.query,results:x.pagination.data.map(j=>j.id),date:i.toAbsoluteString()})},{data:r}=le(s,{perPage:5,categoryIds:a},{onSearch:u}),c=r==null?void 0:r.pagination.data,g=!!(c!=null&&c.length);return e.jsx(E,{children:e.jsxs(H.div,{variants:L.variants,transition:L.transition,initial:!1,animate:g?"open":"closed",children:[e.jsxs("div",{className:"mb-10 mt-24 text-xl font-semibold",children:[e.jsx(n,{message:"Were you looking for"}),":"]}),c==null?void 0:c.map(x=>e.jsx(de,{article:x,className:"block py-10 text-sm text-primary",target:"_blank"},x.id))]},"drawer")})}function is(){const s=p(),t=q(),a=ts(),{envato:i}=K();return e.jsxs("div",{children:[e.jsx(T,{menuPosition:"header",children:e.jsx(I,{})}),e.jsxs("div",{className:"container mx-auto px-12 pb-48 md:px-24",children:[e.jsxs(P,{size:"sm",className:"mb-34 mt-34 md:mb-48",children:[e.jsx(h,{onSelected:()=>s("/hc"),children:e.jsx(n,{message:"Help center"})}),e.jsx(h,{onSelected:()=>s("/hc/tickets"),children:e.jsx(n,{message:"Requests"})}),e.jsx(h,{children:e.jsx(n,{message:"New request"})})]}),e.jsxs("div",{className:"flex items-stretch gap-44",children:[e.jsxs("main",{className:"flex-auto",children:[e.jsx("h1",{className:"mb-34 mt-14 text-3xl font-light",children:e.jsx(n,{message:t.title})}),a.error&&i.enable&&i.require_purchase_code&&e.jsx(ls,{}),a.data?e.jsx(rs,{ticketCategories:a.data.pagination.data}):null]}),e.jsx(cs,{})]})]})]})}function rs({ticketCategories:s}){var F,A,_;const t=q(),a=p(),i=me({defaultValues:{category_id:(F=s[0])==null?void 0:F.id}}),u=(A=i.formState.errors.body)==null?void 0:A.message,r=Ce(i),c=d.useRef(null),[g,x]=d.useState([]),j=i.watch("subject"),v=(_=s.find(o=>i.watch("category_id")==o.id))==null?void 0:_.categories.map(o=>o.id),y=ue(),f=d.useRef([]),m=i.watch("category_id"),l=s.find(o=>o.id==m);console.log("selectedCategory",l);const R=()=>{r.mutate({...i.getValues(),body:_e(c)||"",attachments:g.map(o=>o.id),suggestionLog:f.current},{onSuccess:()=>{y.updateLastSearch({createdTicket:!0}),a("/hc/tickets")}})},k=xe();return e.jsxs(he,{form:i,onSubmit:()=>R(),onBeforeSubmit:()=>i.clearErrors(),children:[e.jsx(ge,{name:"category_id",label:e.jsx(n,{message:t.categoryLabel}),selectionMode:"single",className:"mb-24",errorMessage:l&&l.support_expired&&e.jsx(n,{message:"Your support for this item has expired. <a>Click here to renew</a>",values:{a:o=>e.jsx("a",{href:"https://codecanyon.net/downloads",target:"_blank",rel:"noreferrer",className:"font-bold underline",children:o})}}),children:s.map(o=>e.jsx(b,{value:o.id,children:o.display_name||o.name},o.id))}),e.jsx(je,{name:"subject",label:e.jsx(n,{message:t.subjectLabel})}),e.jsx(ns,{query:j,suggestionLog:f,hcCategoryIds:v}),e.jsxs("div",{className:"my-24",children:[e.jsx("div",{className:k.label,children:e.jsx(n,{message:t.descriptionLabel})}),(l==null?void 0:l.description_ticket_page)&&e.jsx("div",{className:`[&_a]:underline ${k.label}`,children:e.jsx("div",{dangerouslySetInnerHTML:{__html:l.description_ticket_page}})}),e.jsx($,{children:e.jsx(Q,{autoFocus:!1,minHeight:"min-h-[300px]",isLoading:r.isPending,editorRef:c,attachments:g,onAttachmentsChange:o=>x(o),onSubmit:()=>R()})}),u&&e.jsx("div",{className:k.error,children:u})]}),e.jsx(S,{variant:"flat",color:"primary",type:"submit",disabled:r.isPending,children:e.jsx(n,{message:t.submitButtonText})})]})}function cs(){var t;const s=q();return e.jsxs("aside",{className:"w-500 border-l px-40 max-md:hidden",children:[e.jsx("h2",{className:"mb-34 text-xl font-medium",children:e.jsx(n,{message:s.sidebarTitle})}),(t=s.sidebarTips)==null?void 0:t.map((a,i)=>e.jsx(os,{title:e.jsx(n,{message:a.title}),children:e.jsx(n,{message:a.content})},i))]})}function os({title:s,children:t}){return e.jsxs("div",{className:"mb-30",children:[e.jsx("h3",{className:"text-lg font-medium",children:s}),e.jsx("p",{children:t})]})}function ls(){return e.jsx("div",{className:"text-sm text-danger",children:e.jsx(n,{message:"There was an issue fetching your purchase codes from envato. Try to logout and use 'login with envato' button."})})}const ds=[{path:"/",element:e.jsx(Oe,{})},{path:"/new",element:e.jsx(is,{})},{path:":ticketId",element:e.jsx(Ye,{})},{path:"*",element:e.jsx(fe,{})}];function ks(){return pe(ds)}export{ks as default};
//# sourceMappingURL=hc-ticket-routes-d244def4.js.map
