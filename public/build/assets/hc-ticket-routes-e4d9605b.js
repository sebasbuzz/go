import{u as F,f as Q,a1 as $,a2 as I,a3 as A,s as G,h as y,y as L,d as j,j as e,N as P,H as E,B,e as h,T as i,aE as W,r as u,a6 as U,ax as H,w as Y,Z,au as J,$ as X,i as b,ab as ee,k as se,aj as te,b as M,G as ae,m as ne,p as ie,A as re,aG as ce,F as oe,aP as de,aH as me,aR as _,aa as C,aQ as le,O as ue,d0 as xe,W as he}from"./main-8aeb0a0e.js";import{S as ge,T as je,b as pe,c as fe,I as ye,u as be,i as ke}from"./use-create-ticket-27d9c845.js";import{R as D,A as ve,F as Ne,h as Te,s as q,g as Se}from"./reply-editor-0c49b8d8.js";import{R as Re}from"./Reply-b2784dc8.js";import{S as we,u as _e}from"./use-customer-ticket-request-types-97f3aa8f.js";import"./dashboard-sidenav-12d26e2d.js";function Ce(){const{ticketId:s}=F();return Q({mutationFn:a=>qe({ticketId:s,...a}),onSuccess:async()=>{await $.invalidateQueries({queryKey:["tickets"]}),I(A("Reply submitted"))},onError:a=>G(a)})}function qe(s){var t;const a={body:s.body,attachments:(t=s.attachments)==null?void 0:t.map(n=>n.id)};return y.post(`tickets/${s.ticketId}/replies`,a).then(n=>n.data)}function Fe(s){return L({queryKey:["new-team",s],queryFn:()=>Ie(s)})}function Ie(s){return y.get(`teams/${s}`).then(a=>a.data)}const Ae={month:"short",day:"numeric"};function Le(){const s=j();return e.jsxs("div",{children:[e.jsx(P,{menuPosition:"header",children:e.jsx(E,{})}),e.jsxs("div",{className:"container mx-auto px-12 pb-48 md:px-24",children:[e.jsxs(B,{size:"sm",className:"mb-34 mt-34 md:mb-48",children:[e.jsx(h,{onSelected:()=>s("/hc"),children:e.jsx(i,{message:"Help center"})}),e.jsx(h,{onSelected:()=>s("/hc/tickets"),children:e.jsx(i,{message:"Requests"})}),e.jsx(h,{children:e.jsx(i,{message:"Current ticket"})})]}),e.jsx("main",{children:e.jsx(Pe,{})})]})]})}function Pe(){const s=W(),[a,t]=u.useState(!1);return U("window","r",()=>t(!0)),e.jsx(u.Fragment,{children:s.data?e.jsxs(u.Fragment,{children:[s.data.ticket.status==="locked"&&e.jsx(we,{className:"mb-44 text-center",color:"danger",title:e.jsx(i,{message:"This ticket was locked due to inactivity. To reply, create a new ticket."})}),e.jsx(Be,{ticket:s.data.ticket,editorIsOpen:a,onOpenEditor:()=>t(!0)}),e.jsx(H,{children:a&&e.jsx(Ee,{onClose:()=>t(!1)})}),e.jsx(He,{data:s.data})]}):e.jsx(Y,{query:s,loaderClassName:"absolute inset-0 m-auto"})})}function Ee({onClose:s}){const a=u.useRef(null),t=Ce(),[n,r]=u.useState([]);return e.jsx(D,{isLoading:t.isPending,footerButtons:e.jsx(ge,{}),editorRef:a,className:"mb-24",attachments:n,onAttachmentsChange:o=>r(o),onSubmit:o=>t.mutate(o,{onSuccess:()=>s()})})}function Be({ticket:s,onOpenEditor:a,editorIsOpen:t}){var d,x;const{assignee:n}=s,r=n==null?void 0:n.team_id,o=Fe(r);return e.jsxs("div",{className:"mb-44",children:[e.jsxs("div",{className:"flex items-center gap-24",children:[e.jsxs("div",{className:"whitespace-nowrap text-muted max-md:hidden",children:[e.jsx(Z,{date:s.created_at})," (",e.jsx(J,{date:s.created_at,options:Ae}),")"]}),e.jsxs("div",{className:"text-2xl md:ml-auto",children:["#",s.id]}),e.jsx(X,{size:"sm",color:s.closed_at?void 0:"primary",radius:"rounded",className:"min-w-60 font-bold capitalize",children:s.status})]}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx("h1",{className:"my-12 text-2xl",children:s.subject}),e.jsx(je,{ticketRequestType:s.ticket_request_type})]}),e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx("div",{className:"mr-auto font-semibold max-md:hidden flex gap-4 items-center",children:r&&o&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted",children:"Assigned to:"})," ",e.jsx("span",{className:"font-medium",children:(x=(d=o==null?void 0:o.data)==null?void 0:d.team)==null?void 0:x.display_name})]})}),!s.closed_at&&e.jsx(De,{}),e.jsx(b,{size:"sm",variant:"outline",startIcon:e.jsx(Re,{}),disabled:t,onClick:()=>a(),children:e.jsx(i,{message:"Add a reply"})})]})]})}function He({data:{ticket:s,replies:a}}){const t=pe(s.id,a);return e.jsxs(u.Fragment,{children:[t.items.map(n=>{var o,d;const r=!t.hasNextPage&&n.id===((o=t.items.at(-1))==null?void 0:o.id);return e.jsx(fe,{className:"px-12",reply:n,isInitial:r,ticketRequestType:s.ticket_request_type,attachments:(d=n.attachments)!=null&&d.length?e.jsx(Me,{attachments:n.attachments}):null},n.id)}),e.jsx(ye,{query:t})]})}function Me({attachments:s}){return e.jsx(ve,{className:"mt-30 w-max",children:s.map((a,t)=>e.jsx(Ne,{attachments:s,index:t},a.id))})}function De(){const s=be(),{ticketId:a}=F(),t=j();return e.jsxs(ee,{type:"modal",children:[e.jsx(b,{size:"sm",variant:"outline",startIcon:e.jsx(se,{}),children:e.jsx(i,{message:"Mark as solved"})}),({close:n})=>e.jsx(te,{onConfirm:()=>{s.mutate({ids:[a],status:"closed"},{onSuccess:()=>{n(),I(A("Ticked marked as solved")),t("/hc/tickets")}})},isLoading:s.isPending,title:e.jsx(i,{message:"Mark as solved"}),body:e.jsx(i,{message:"Are you sure you want to mark this ticket as solved?"}),confirm:e.jsx(i,{message:"Confirm"})})]})}function ze(){return L({queryKey:["new-ticket-categories"],queryFn:()=>Ve()})}function Ve(){return y.get("ticket-categories",{params:{perPage:25,with:"categories",orderBy:"name",orderDir:"asc",filterByPurchases:!0,paginate:"simple"}}).then(s=>s.data)}function k(){var a,t;return((t=(a=M().hc)==null?void 0:a.newTicket)==null?void 0:t.appearance)||{}}function Ke({query:s,suggestionLog:a,hcCategoryIds:t}){const n=Te(),r=m=>{m.pagination.data.length&&a.current.push({term:m.query,results:m.pagination.data.map(p=>p.id),date:n.toAbsoluteString()})},{data:o}=ae(s,{perPage:5,categoryIds:t},{onSearch:r}),d=o==null?void 0:o.pagination.data,x=!!(d!=null&&d.length);return e.jsx(ne,{children:e.jsxs(ie.div,{variants:q.variants,transition:q.transition,initial:!1,animate:x?"open":"closed",children:[e.jsxs("div",{className:"mb-10 mt-24 text-xl font-semibold",children:[e.jsx(i,{message:"Were you looking for"}),":"]}),d==null?void 0:d.map(m=>e.jsx(re,{article:m,className:"block py-10 text-sm text-primary",target:"_blank"},m.id))]},"drawer")})}function Oe(){const s=j(),a=k(),t=ze(),n=_e(),{envato:r}=M();return e.jsxs("div",{children:[e.jsx(P,{menuPosition:"header",children:e.jsx(E,{})}),e.jsxs("div",{className:"container mx-auto px-12 pb-48 md:px-24",children:[e.jsxs(B,{size:"sm",className:"mb-34 mt-34 md:mb-48",children:[e.jsx(h,{onSelected:()=>s("/hc"),children:e.jsx(i,{message:"Help center"})}),e.jsx(h,{onSelected:()=>s("/hc/tickets"),children:e.jsx(i,{message:"Requests"})}),e.jsx(h,{children:e.jsx(i,{message:"New request"})})]}),e.jsxs("div",{className:"flex items-stretch gap-44",children:[e.jsxs("main",{className:"flex-auto",children:[e.jsx("h1",{className:"mb-34 mt-14 text-3xl font-light",children:e.jsx(i,{message:a.title})}),t.error&&r.enable&&r.require_purchase_code&&e.jsx(We,{}),t.data&&n.data?e.jsx(Qe,{ticketCategories:t.data.pagination.data,ticketRequestTypes:n.data.pagination.data}):null]}),e.jsx($e,{})]})]})]})}function Qe({ticketCategories:s,ticketRequestTypes:a}){var T,S,R,w;console.log("ticketCategories",s);const t=k(),n=j(),r=ce({defaultValues:{category_id:(T=s[0])==null?void 0:T.id,ticket_request_type:(S=a[0])==null?void 0:S.id}}),o=(R=r.formState.errors.body)==null?void 0:R.message,d=ke(r),x=u.useRef(null),[m,p]=u.useState([]),z=r.watch("subject"),V=(w=s.find(c=>r.watch("category_id")==c.id))==null?void 0:w.categories.map(c=>c.id),K=oe(),v=u.useRef([]),O=r.watch("category_id"),l=s.find(c=>c.id==O),g=l==null?void 0:l.ticket_request_type,N=()=>{console.log("form.getValues()",r.getValues()),d.mutate({...r.getValues(),body:Se(x)||"",attachments:m.map(c=>c.id),suggestionLog:v.current},{onSuccess:()=>{K.updateLastSearch({createdTicket:!0}),n("/hc/tickets")}})},f=de();return e.jsxs(me,{form:r,onSubmit:()=>N(),onBeforeSubmit:()=>r.clearErrors(),children:[e.jsx(_,{name:"category_id",label:e.jsx(i,{message:t.categoryLabel}),selectionMode:"single",className:"mb-24",errorMessage:l&&l.support_expired&&e.jsx(i,{message:"Your support for this item has expired. <a>Click here to renew</a>",values:{a:c=>e.jsx("a",{href:"https://codecanyon.net/downloads",target:"_blank",rel:"noreferrer",className:"font-bold underline",children:c})}}),children:s.map(c=>e.jsx(C,{value:c.id,children:c.display_name||c.name},c.id))}),(g==null?void 0:g.length)>0&&e.jsx(_,{name:"ticket_request_type",label:e.jsx(i,{message:"Request Type"}),selectionMode:"single",className:"mb-24",children:g.map(c=>e.jsx(C,{value:c.id,children:c.display_name||c.name},c.id))}),e.jsx(le,{name:"subject",label:e.jsx(i,{message:t.subjectLabel})}),e.jsx(Ke,{query:z,suggestionLog:v,hcCategoryIds:V}),e.jsxs("div",{className:"my-24",children:[e.jsx("div",{className:f.label,children:e.jsx(i,{message:t.descriptionLabel})}),(l==null?void 0:l.description_ticket_page)&&e.jsx("div",{className:`[&_a]:underline ${f.label}`,children:e.jsx("div",{dangerouslySetInnerHTML:{__html:l.description_ticket_page}})}),e.jsx(H,{children:e.jsx(D,{autoFocus:!1,minHeight:"min-h-[300px]",isLoading:d.isPending,editorRef:x,attachments:m,onAttachmentsChange:c=>p(c),onSubmit:()=>N()})}),o&&e.jsx("div",{className:f.error,children:o})]}),e.jsx(b,{variant:"flat",color:"primary",type:"submit",disabled:d.isPending,children:e.jsx(i,{message:t.submitButtonText})})]})}function $e(){var a;const s=k();return e.jsxs("aside",{className:"w-500 border-l px-40 max-md:hidden",children:[e.jsx("h2",{className:"mb-34 text-xl font-medium",children:e.jsx(i,{message:s.sidebarTitle})}),(a=s.sidebarTips)==null?void 0:a.map((t,n)=>e.jsx(Ge,{title:e.jsx(i,{message:t.title}),children:e.jsx(i,{message:t.content})},n))]})}function Ge({title:s,children:a}){return e.jsxs("div",{className:"mb-30",children:[e.jsx("h3",{className:"text-lg font-medium",children:s}),e.jsx("p",{children:a})]})}function We(){return e.jsx("div",{className:"text-sm text-danger",children:e.jsx(i,{message:"There was an issue fetching your purchase codes from envato. Try to logout and use 'login with envato' button."})})}const Ue=[{path:"/",element:e.jsx(xe,{})},{path:"/new",element:e.jsx(Oe,{})},{path:":ticketId",element:e.jsx(Le,{})},{path:"*",element:e.jsx(he,{})}];function ts(){return ue(Ue)}export{ts as default};
//# sourceMappingURL=hc-ticket-routes-e4d9605b.js.map
