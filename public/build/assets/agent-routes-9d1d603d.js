import{X as q,d as R,r as d,j as e,Y as Fe,T as c,Z as Re,$ as re,z as Gs,n as F,c as w,a0 as ze,y as J,h as y,f as L,a1 as k,a2 as _,a3 as h,s as N,a4 as ie,I as D,i as g,a5 as ce,a6 as U,a7 as O,a8 as pe,a9 as $,aa as j,ab as X,ac as fe,ad as A,ae as Q,af as G,ag as H,ah as ds,ai as Z,aj as le,ak as Ys,p as W,al as Ee,J as Me,K as us,m as ee,am as Js,an as ms,q as Y,S as qe,ao as Xs,l as xs,N as Zs,ap as et,aq as hs,ar as gs,as as Oe,at as st,M as js,au as P,G as ps,av as fs,D as tt,E as ys,u as B,b as se,aw as $e,ax as ye,ay as z,V as at,az as nt,aA as it,aB as rt,aC as ct,v as lt,aD as ot,A as dt,aE as Be,w as be,aF as Ke,aG as ve,aH as ke,aI as ut,aJ as mt,o as bs,aK as xt,aL as ht,aM as gt,aN as jt,aO as pt,aP as ft,aQ as Se,aR as je,aS as yt,aT as bt,C as vt,aU as kt,aV as St,aW as wt,aX as Tt,aY as Lt,O as Ct,aZ as as,W as Nt}from"./main-8aeb0a0e.js";import{C as we,u as It,D as vs,G as Ue,F as xe,a as he,c as Dt,b as _t,t as At,U as ns,A as Pt,d as Ft,T as ks,e as Ss,f as _e,N as Rt,B as zt,M as Et,g as Qe,h as Mt,i as qt,j as Ot,k as ws,I as Ts,l as $t,S as Bt}from"./search-report-table-847434bd.js";import{T as Ls,U as He,u as Kt,a as E,b as Cs,c as Ae,I as Ve,d as Ut,e as Qt,g as Pe,t as b,f as Ns,S as Ht,h as Vt,i as Wt}from"./use-create-ticket-27d9c845.js";import{a as Is,b as Ds,c as We,d as _s,u as Gt,D as Yt}from"./dashboard-sidenav-12d26e2d.js";import{I as Jt,F as Xt,K as Zt,E as ea,C as sa}from"./Comment-34198f90.js";import{R as Te,g as Le,A as As,F as Ps,i as ta}from"./reply-editor-0c49b8d8.js";import{R as aa}from"./Reply-b2784dc8.js";import"./Edit-a5c373f3.js";const na=""+new URL("opened-bde6b15c.svg",import.meta.url).href,Fs="1",Rs="20";function te(){const[s]=q();return{tagId:s.get("tagId")||"unassigned",page:s.get("page")||Fs,perPage:s.get("perPage")||Rs,orderBy:s.get("orderBy")||"",orderDir:s.get("orderDir")||""}}function zs(){const s=R(),t=te();return d.useCallback((a={})=>{const n=Es(t,a);s(n)},[t,s])}function ia(s={}){const t=te();return Es(t,s)}function Es(s,t={}){const a=t.tagId||s.tagId,n=`${t.page||s.page}`,i=`${t.perPage||s.perPage}`,r="orderBy"in t?t.orderBy:s.orderBy,l="orderDir"in t?t.orderDir:s.orderDir;let o=`/agent/tickets?tagId=${a}`;return n!==Fs&&(o+=`&page=${n}`),i!==Rs&&(o+=`&perPage=${i}`),r&&(o+=`&orderBy=${r}`),l&&(o+=`&orderDir=${l}`),o}function ra({onPageChange:s,onPerPageChange:t,query:a}){return e.jsx(Fe,{className:"flex-shrink-0",onPerPageChange:t,onPageChange:s,query:a})}const ca=[{key:"user_id",allowsSorting:!0,header:()=>e.jsx(c,{message:"Customer"}),visibleInMode:"all",width:"w-132",body:s=>s.user?s.user.display_name:"-"},{key:"avatar",header:()=>e.jsx(c,{message:"Avatar"}),hideHeader:!0,width:"w-100 flex-shrink-0",body:s=>s.user?e.jsx("img",{className:"m-auto h-38 w-38 rounded-full",src:s.user.avatar,alt:""}):"-"},{key:"summary",header:()=>e.jsx(c,{message:"Ticket summary"}),body:s=>e.jsx(la,{ticket:s}),width:"flex-3 min-w-200"},{key:"replies_count",header:()=>e.jsx(c,{message:"Replies count"}),hideHeader:!0,width:"w-50",body:s=>e.jsx("div",{className:"w-max rounded border bg-alt px-6 text-xs font-normal text-muted",children:s.replies_count||1})},{key:"assigned_to",allowsSorting:!0,header:()=>e.jsx(c,{message:"Assigned to"}),width:"w-124",body:s=>s.assignee?s.assignee.display_name:""},{key:"id",allowsSorting:!0,header:()=>e.jsx(c,{message:"Number"}),width:"w-90",body:s=>s.id},{key:"updated_at",allowsSorting:!0,header:()=>e.jsx(c,{message:"Last updated"}),visibleInMode:"all",width:"w-144",body:s=>e.jsx(Re,{date:s.updated_at})}];function la({ticket:s}){var n,i,r,l;const t=(n=s.latest_reply)!=null&&n.body?s.latest_reply.body:(r=(i=s.replies)==null?void 0:i[0])==null?void 0:r.body,a=(l=s.tags)==null?void 0:l.filter(o=>o.type!=="status");return e.jsxs("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap pr-12",children:[e.jsxs("div",{className:"flex items-center gap-10",children:[e.jsx(we,{size:"xs",wrap:!1,children:a==null?void 0:a.map(o=>e.jsx(re,{children:o.display_name||o.name},o.id))}),e.jsx(Ls,{ticketRequestType:s.ticket_request_type}),e.jsx("div",{children:s.subject})]}),t&&e.jsx("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap pt-4 font-normal text-muted",children:t})]})}function oa({ticket:s,className:t,children:a,color:n="inherit",...i}){const r=d.useMemo(()=>Ce(s),[s]);return e.jsx(F,{...i,className:w(n==="primary"?"text-primary hover:text-primary-dark":"text-inherit","overflow-x-hidden overflow-ellipsis outline-none transition-colors hover:underline focus-visible:underline",t),to:r,children:a??s.subject})}function Ce(s,{absolute:t,tagId:a}={}){let n=`/agent/tickets/${s.id}`;return t&&(n=`${Gs().settings.base_url}${n}`),a&&(n=`${n}?tagId=${a}`),n}function Ge({query:s,selectedTickets:t,onSelectionChange:a,sortDescriptor:n,onSortChange:i}){var o;const r=R(),{tagId:l}=te();return e.jsx(ze,{headerCellHeight:"h-36",cellHeight:"h-64",selectedRows:t,onSelectionChange:u=>a==null?void 0:a(u),columns:ca,data:((o=s.data)==null?void 0:o.pagination.data)||[],renderRowAs:da,onAction:u=>r(Ce(u,{tagId:l})),sortDescriptor:n,onSortChange:i})}function da({children:s,item:t,className:a,...n}){return e.jsx("div",{className:w(a,t.status==="open"&&"font-semibold",t.closed_at&&"bg-alt"),...n,children:s})}const ua="tickets.update",ma="ticket";function xa(){return J({queryKey:["users","agents"],queryFn:()=>ha()})}function ha(){return y.get("users",{params:{permission:ua,perPage:20}}).then(s=>s.data)}function ga(){return L({mutationFn:s=>ja(s),onSuccess:async()=>{await Promise.allSettled([k.invalidateQueries({queryKey:["mailbox","sidenav-tags"]}),k.invalidateQueries({queryKey:["tickets"]})]),_(h("Tickets reassigned"))},onError:s=>N(s)})}function ja(s){return y.post("tickets/assign",s).then(t=>t.data)}const ae=d.forwardRef(({startIcon:s,endIcon:t,children:a,color:n,isCompact:i=!1,...r},l)=>i?e.jsx(ie,{label:a,ref:l,children:e.jsx(D,{color:n,iconSize:"md",size:"sm",...r,children:s})}):e.jsx(g,{startIcon:s,endIcon:t,variant:"outline",color:n,size:"xs",ref:l,...r,children:a})),pa=ce(e.jsx("path",{d:"M 16 5 C 12.145852 5 9 8.1458513 9 12 C 9 14.408843 10.23116 16.55212 12.09375 17.8125 C 8.5266131 19.342333 6 22.881262 6 27 L 8 27 C 8 24.109626 9.5263067 21.592958 11.8125 20.1875 C 12.483006 21.834363 14.120749 23 16 23 C 17.879251 23 19.516994 21.834363 20.1875 20.1875 C 22.473693 21.592958 24 24.109626 24 27 L 26 27 C 26 22.881262 23.473387 19.342333 19.90625 17.8125 C 21.76884 16.55212 23 14.408843 23 12 C 23 8.1458513 19.854148 5 16 5 z M 16 7 C 18.773268 7 21 9.2267317 21 12 C 21 14.773268 18.773268 17 16 17 C 13.226732 17 11 14.773268 11 12 C 11 9.2267317 13.226732 7 16 7 z M 16 19 C 16.81989 19 17.600009 19.116459 18.34375 19.34375 C 17.997935 20.307297 17.090648 21 16 21 C 14.909352 21 14.002065 20.307297 13.65625 19.34375 C 14.399991 19.116459 15.18011 19 16 19 z"}),"","0 0 32 32");function Ms({ticketIds:s,onSuccess:t,isCompact:a}){const{data:n}=xa(),i=ga(),[r,l]=d.useState(!1);return U("window","a",()=>l(!0)),e.jsxs(O,{isOpen:r,onOpenChange:l,onItemSelected:o=>i.mutate({ticketIds:s,userId:o},{onSuccess:t}),children:[e.jsx(ae,{isCompact:a,startIcon:e.jsx(pa,{}),endIcon:e.jsx(pe,{}),disabled:i.isPending,children:e.jsx(c,{message:"Assign (a)"})}),e.jsx($,{children:n==null?void 0:n.pagination.data.map(o=>e.jsx(j,{value:o.id,startIcon:e.jsx(He,{user:o,size:"sm"}),children:o.display_name},o.id))})]})}function oe(){return J({queryKey:["mailbox","sidenav-tags"],queryFn:()=>fa()})}function fa(){return y.get("tags/agent-mailbox").then(s=>s.data)}const ya=ce(e.jsx("path",{d:"M 5 5 L 5 6 L 5 29 L 7 29 L 7 19 L 15 19 L 15 21 L 15 22 L 16 22 L 26 22 L 27 22 L 27 21 L 27 9 L 27 8 L 26 8 L 17 8 L 17 6 L 17 5 L 16 5 L 6 5 L 5 5 z M 7 7 L 15 7 L 15 8 L 15 9 L 15 17 L 7 17 L 7 7 z M 17 10 L 25 10 L 25 20 L 17 20 L 17 19 L 17 18 L 17 10 z"}),"","0 0 32 32");function qs({ticketIds:s,onSuccess:t,isCompact:a}){const{data:n}=oe(),i=Kt(),[r,l]=d.useState(!1);return U("window","s",()=>l(!0)),e.jsxs(O,{isOpen:r,onOpenChange:l,onItemSelected:o=>i.mutate({ids:s,status:o},{onSuccess:()=>{t==null||t(),_(h("Status changed"))}}),children:[e.jsx(ae,{isCompact:a,startIcon:e.jsx(ya,{}),endIcon:e.jsx(pe,{}),disabled:i.isPending,children:e.jsx(c,{message:"Change status (s)"})}),e.jsx($,{children:n==null?void 0:n.statusTags.map(o=>e.jsx(j,{value:o.name,capitalizeFirst:!0,children:o.display_name||o.name},o.id))})]})}function ba(){return L({mutationFn:s=>va(s),onSuccess:async()=>{k.invalidateQueries({queryKey:["mailbox","sidenav-tags"]}),await k.invalidateQueries({queryKey:["tickets"]}),_(h("Tag added"))},onError:s=>N(s)})}function va(s){return y.post("tickets/tags/add",s).then(t=>t.data)}const ka=ce(e.jsx("path",{d:"M 16 5 L 15.6875 5.28125 L 4.28125 16.8125 L 3.59375 17.5 L 4.28125 18.21875 L 13.78125 27.71875 L 14.5 28.40625 L 15.1875 27.71875 L 16.40625 26.5 C 17.46025 29.688126 20.466215 32 24 32 C 28.406433 32 32 28.406433 32 24 C 32 20.501976 29.731898 17.519896 26.59375 16.4375 L 26.71875 16.3125 L 27 16 L 27 15.59375 L 27 6 L 27 5 L 26 5 L 16.40625 5 L 16 5 z M 16.84375 7 L 25 7 L 25 15.15625 L 24.15625 16 C 24.103605 15.99897 24.052884 16 24 16 C 19.593567 16 16 19.593567 16 24 C 16 24.03173 15.999628 24.062105 16 24.09375 L 14.5 25.59375 L 6.40625 17.5 L 16.84375 7 z M 22 9 C 21.447715 9 21 9.4477153 21 10 C 21 10.552285 21.447715 11 22 11 C 22.552285 11 23 10.552285 23 10 C 23 9.4477153 22.552285 9 22 9 z M 24 18 C 27.325553 18 30 20.674447 30 24 C 30 27.325553 27.325553 30 24 30 C 20.674447 30 18 27.325553 18 24 C 18 20.674447 20.674447 18 24 18 z M 23 20 L 23 23 L 20 23 L 20 25 L 23 25 L 23 28 L 25 28 L 25 25 L 28 25 L 28 23 L 25 23 L 25 20 L 23 20 z"}),"","0 0 32 32");function Os({ticketIds:s,onSuccess:t,isCompact:a}){const n=ba(),[i,r]=d.useState(!1);return U("window","t",()=>r(!0)),e.jsxs(X,{isOpen:i,onOpenChange:r,type:"popover",onClose:l=>{l&&n.mutate({tagName:l,ticketIds:s},{onSuccess:t})},children:[e.jsx(ae,{startIcon:e.jsx(ka,{}),isCompact:a,disabled:n.isPending,children:e.jsx(c,{message:"Add tag (t)"})}),e.jsx(Sa,{})]})}function Sa(){const{trans:s}=fe(),[t,a]=d.useState(""),[n,i]=d.useState(""),{data:r,isFetching:l}=It({query:t,perPage:8,notType:"status"}),{close:o,formId:u}=A();return e.jsxs(Q,{size:"sm",children:[e.jsx(G,{children:e.jsx(c,{message:"Add tag"})}),e.jsx(H,{children:e.jsx("form",{id:u,onSubmit:m=>{m.preventDefault(),o(n)},children:e.jsx(ds,{isAsync:!0,isLoading:l,inputValue:t,onInputValueChange:a,selectedValue:n,onSelectionChange:m=>i(m),selectionMode:"single",placeholder:s(h("Enter tag name...")),allowCustomValue:!0,autoFocus:!0,children:r==null?void 0:r.pagination.data.map(m=>e.jsx(j,{value:m.name,textLabel:m.name,capitalizeFirst:!0,className:"rounded",children:m.display_name||m.name},m.id))})})}),e.jsxs(Z,{children:[e.jsx(g,{onClick:()=>o(),children:e.jsx(c,{message:"Cancel"})}),e.jsx(g,{variant:"flat",color:"primary",type:"submit",form:u,children:e.jsx(c,{message:"Add"})})]})]})}function wa(){return L({mutationFn:s=>Ta(s),onSuccess:async()=>{await k.invalidateQueries({queryKey:["tickets"]}),_(h("Tickets deleted"))},onError:s=>N(s)})}function Ta({ids:s}){return y.delete(`tickets/${s.join(",")}`).then(t=>t.data)}function La({ticketIds:s,onSuccess:t,isCompact:a}){const[n,i]=d.useState(!1);return U("window","d",()=>i(!0)),e.jsxs(X,{type:"modal",isOpen:n,onOpenChange:i,children:[e.jsx(ae,{startIcon:e.jsx(vs,{}),color:"danger",isCompact:a,children:e.jsx(c,{message:"Delete (d)"})}),e.jsx(Ca,{ticketIds:s,onDeleted:t})]})}function Ca({ticketIds:s,onDeleted:t}){const a=wa(),{close:n}=A();return e.jsx(le,{isDanger:!0,isLoading:a.isPending,onConfirm:()=>{a.mutate({ids:s},{onSuccess:()=>{n(),t==null||t()}})},title:e.jsx(c,{message:"Delete tickets"}),body:e.jsx(c,{message:"Are you sure you want to delete selected tickets?"}),confirm:e.jsx(c,{message:"delete"})})}function Ye({ticketIds:s,onActionCompleted:t}){const a=d.useRef(null);return Ys({autoFocus:!0},a),e.jsxs(W.div,{ref:a,initial:{y:-30,opacity:1},animate:{y:0,opacity:1},exit:{y:30,opacity:0},tabIndex:-1,role:"menu",className:"fixed left-0 right-0 top-120 mx-auto flex w-max items-center justify-center gap-12 rounded border bg p-14 shadow-lg outline-none focus-visible:ring-2",children:[e.jsx(Ms,{ticketIds:s,onSuccess:t}),e.jsx(qs,{ticketIds:s,onSuccess:t}),e.jsx(Os,{ticketIds:s,onSuccess:t}),e.jsx(La,{ticketIds:s,onSuccess:t})]})}function Na(){const[s]=q(),t=s.get("orderBy")||"",a=s.get("orderDir")||"",n=d.useMemo(()=>({orderBy:t,orderDir:a}),[t,a]),i=Ee({...te(),loader:"ticketTable"}),{data:r,isLoading:l,isPlaceholderData:o}=i,u=(r==null?void 0:r.pagination.data)||[],m=!l&&!o&&u.length===0,v=zs(),[p,S]=d.useState([]);return e.jsxs(d.Fragment,{children:[e.jsx(Ue,{query:i}),e.jsxs("div",{className:"flex min-h-full min-w-0 flex-col",children:[e.jsxs("div",{className:"flex-auto",children:[e.jsx(Ge,{query:i,selectedTickets:p,onSelectionChange:S,sortDescriptor:n,onSortChange:f=>{v({orderBy:f.orderBy,orderDir:f.orderDir})}}),m&&e.jsx(Me,{className:"mt-40",size:"sm",image:e.jsx(us,{src:na}),title:e.jsx(c,{message:"There are no tickets in this category yet."})})]}),e.jsx(ra,{query:i,onPageChange:f=>v({page:f}),onPerPageChange:f=>v({perPage:f})}),e.jsx(ee,{children:p.length&&e.jsx(Ye,{ticketIds:p,onActionCompleted:()=>S([])})})]})]})}function Je({element:s,onOpenSearchPage:t}){const a=R(),n=d.useCallback(()=>{a("/agent/search")},[a]),i=s;return e.jsx(i,{menuPosition:"agent-mailbox",color:"bg",size:"md",children:e.jsx(Js,{size:"sm",width:"w-320",onTrigger:t||n,children:e.jsx(c,{message:"Search"})})})}function Ia(){const s=R();return e.jsxs("aside",{className:"compact-scrollbar flex w-full flex-col gap-24 overflow-y-auto border-r text-muted",children:[e.jsxs("div",{className:"flex-auto",children:[e.jsx(is,{icon:e.jsx(Jt,{}),children:e.jsx(c,{message:"Inbox"})}),e.jsx(rs,{type:"viewTags"}),e.jsx(is,{icon:e.jsx(Xt,{}),children:e.jsx(c,{message:"Folders"})}),e.jsx(rs,{type:"categoryTags"})]}),e.jsx("div",{className:"mt-auto p-14",children:e.jsxs(O,{placement:"top",children:[e.jsx(g,{className:"min-h-34 w-full",variant:"outline",startIcon:e.jsx(ms,{}),endIcon:e.jsx(Zt,{}),size:"xs",children:e.jsx(c,{message:"Settings"})}),e.jsxs($,{children:[e.jsx(j,{value:"saved-replies",onSelected:()=>s("/agent/saved-replies"),children:e.jsx(c,{message:"Saved replies"})}),e.jsx(j,{value:"new-ticket",onSelected:()=>s("/agent/tickets/new"),children:e.jsx(c,{message:"New ticket"})}),e.jsx(j,{value:"notifications",onSelected:()=>s("/notifications/settings"),children:e.jsx(c,{message:"Notifications"})})]})]})})]})}function is({icon:s,children:t}){return e.jsxs("div",{className:"mb-14 flex items-center gap-8 px-14 pt-20",children:[s,e.jsx("div",{className:"text-sm font-semibold uppercase",children:t})]})}const $s="flex h-40 items-center justify-between gap-8 pl-38 pr-8 mx-8 rounded-lg";function rs({type:s}){const{data:t,isLoading:a}=oe(),n=t==null?void 0:t[s],i=e.jsx(W.div,{...Y,children:[...Array(4)].map((r,l)=>e.jsx("div",{className:w($s,"max-w-172 border-l-transparent"),children:e.jsx(qe,{variant:"text"})},l))},"skeletons");return e.jsx(ee,{initial:!1,mode:"wait",children:a?i:e.jsx(W.ul,{className:"cursor-pointer text-sm",...Y,children:n==null?void 0:n.map(r=>e.jsx(Da,{tag:r},r.id))},"tag-list")})}function Da({tag:s}){const t=`${s.id}`===te().tagId;return e.jsx("li",{children:e.jsxs(Xs,{className:w($s,t?"border-l-primary bg-primary/6 hover:bg-primary/10":"border-l-transparent hover:bg-hover"),to:`/agent/tickets?tagId=${s.id}`,end:!0,children:[" ",e.jsxs(d.Fragment,{children:[e.jsx(c,{message:s.display_name||s.name}),s.tickets_count?e.jsx("div",{className:w("flex h-18 w-30 items-center justify-center rounded-full text-[11px] font-semibold",t&&"bg-primary text-on-primary"),children:s.tickets_count}):null]})]})},s.id)}function Ne({children:s,rightSidenav:t}){return e.jsxs(Is,{name:"mailbox",children:[e.jsx(Je,{element:Ds}),e.jsx(We,{position:"left",className:"bg-alt",children:e.jsx(Ia,{})}),e.jsx(_s,{children:e.jsx("main",{children:s})}),t]})}function _a(){return e.jsx(Ne,{children:e.jsx(Na,{})})}function Aa(s,t,a){var n=this,i=d.useRef(null),r=d.useRef(0),l=d.useRef(null),o=d.useRef([]),u=d.useRef(),m=d.useRef(),v=d.useRef(s),p=d.useRef(!0);d.useEffect(function(){v.current=s},[s]);var S=!t&&t!==0&&typeof window<"u";if(typeof s!="function")throw new TypeError("Expected a function");t=+t||0;var f=!!(a=a||{}).leading,K=!("trailing"in a)||!!a.trailing,I="maxWait"in a,x=I?Math.max(+a.maxWait||0,t):null;d.useEffect(function(){return p.current=!0,function(){p.current=!1}},[]);var ne=d.useMemo(function(){var Ie=function(T){var C=o.current,me=u.current;return o.current=u.current=null,r.current=T,m.current=v.current.apply(me,C)},de=function(T,C){S&&cancelAnimationFrame(l.current),l.current=S?requestAnimationFrame(T):setTimeout(T,C)},ss=function(T){if(!p.current)return!1;var C=T-i.current;return!i.current||C>=t||C<0||I&&T-r.current>=x},ts=function(T){return l.current=null,K&&o.current?Ie(T):(o.current=u.current=null,m.current)},De=function T(){var C=Date.now();if(ss(C))return ts(C);if(p.current){var me=t-(C-i.current),Ws=I?Math.min(me,x-(C-r.current)):me;de(T,Ws)}},ue=function(){var T=Date.now(),C=ss(T);if(o.current=[].slice.call(arguments),u.current=n,i.current=T,C){if(!l.current&&p.current)return r.current=i.current,de(De,t),f?Ie(i.current):m.current;if(I)return de(De,t),Ie(i.current)}return l.current||de(De,t),m.current};return ue.cancel=function(){l.current&&(S?cancelAnimationFrame(l.current):clearTimeout(l.current)),r.current=0,o.current=i.current=u.current=l.current=null},ue.isPending=function(){return!!l.current},ue.flush=function(){return l.current?ts(Date.now()):m.current},ue},[f,I,t,x,K,S]);return ne}function Pa(){const{data:s}=oe();return d.useMemo(()=>s?[{key:"status",label:h("Status"),description:h("Ticket status"),defaultOperator:xe.eq,control:{type:he.Select,defaultValue:"01",options:s.statusTags.map(t=>({key:t.id,label:h(t.display_name||t.name),value:t.name}))}},{key:"tag",label:h("Folder"),description:h("Folder ticket is assigned to"),defaultOperator:xe.eq,control:{type:he.Select,defaultValue:"01",options:s.categoryTags.map(t=>({key:t.id,label:h(t.display_name||t.name),value:t.name}))}},Dt({description:h("Date ticket was created")}),_t({description:h("Date ticket was last updated")}),At({key:"closed_at",label:h("Closed at"),description:h("Date ticket was closed")}),{key:"user_id",label:h("Customer"),description:h("Customer that created the ticket"),defaultOperator:xe.eq,control:{type:he.SelectModel,model:ns}},{key:"assigned_to",label:h("Assignee"),description:h("Agent assigned to the ticket"),defaultOperator:xe.eq,control:{type:he.SelectModel,model:ns}}]:null,[s])}function Fa(s=!1){d.useEffect(()=>(s?document.documentElement.classList.remove("stable-scrollbar"):document.documentElement.classList.add("stable-scrollbar"),()=>{document.documentElement.classList.remove("stable-scrollbar")}),[s])}const cs=[{uri:"tickets",label:h("Tickets"),key:0},{uri:"users",label:h("Users"),key:1},{uri:"articles",label:h("Articles"),key:2}];function Ra(){var I;const[s,t]=q(),a=s.get("query")||"",{pathname:n}=xs(),i=n.split("/").pop(),r=((I=cs.find(x=>x.uri===i))==null?void 0:I.key)??0,l=d.useRef(null),[o,u]=d.useState(a);Fa(),d.useEffect(()=>{u(a)},[a]);const m=x=>{t(ne=>(ne.delete("page"),ne.set("query",x),ne))},v=Aa(x=>{m(x)},400),p=x=>{u(x),v(x)},S=d.useCallback(()=>{var x;(x=l.current)==null||x.focus()},[]),f=Pa(),K=f&&r===0;return e.jsxs("div",{children:[e.jsx(Je,{element:Zs,onOpenSearchPage:S}),e.jsxs("main",{className:"container mx-auto p-14 md:p-24",children:[e.jsxs("div",{className:"mb-34 flex items-center gap-24 pt-6",children:[e.jsx("form",{className:"flex-auto",onSubmit:x=>{x.preventDefault(),m(o)},children:e.jsx(et,{onBlur:()=>m(o),inputRef:l,value:o,onChange:x=>{p(x.target.value)},startAdornment:e.jsx(hs,{}),autoFocus:!0})}),K&&e.jsx(Pt,{className:"min-h-42 min-w-42",filters:f})]}),K&&e.jsx(Ft,{filters:f}),e.jsxs(ks,{selectedTab:r,children:[e.jsx(Ss,{children:cs.map(x=>e.jsx(_e,{width:"min-w-132",elementType:F,to:`/agent/search/${x.uri}?query=${o}`,relative:"path",replace:!0,children:e.jsx(c,{...x.label})},x.key))}),e.jsx("div",{className:"pt-34",children:e.jsx(gs,{})})]})]})]})}function za(){const[s]=q(),t={filters:s.get("filters")??"",query:s.get("query")??"",page:s.get("page")??"1",perPage:s.get("perPage")??"20"},a=!!t.query||!!t.filters;return J({queryKey:["tickets","search",t],queryFn:()=>Ea(t),placeholderData:a?Oe:void 0,enabled:a})}function Ea(s){return y.get("search/tickets",{params:s}).then(t=>t.data)}function Xe({query:s,children:t}){const[a,n]=q(),{data:i,fetchStatus:r,isLoading:l,isPlaceholderData:o}=s,u=(i==null?void 0:i.pagination.data)||[],m=r==="idle"&&u.length===0||!l&&!o&&u.length===0;return e.jsxs(d.Fragment,{children:[e.jsx(Ue,{query:s}),t,m&&e.jsx(st,{isFiltering:!!a.get("query")||!!a.get("filters"),className:"mt-48",image:js,title:e.jsx(c,{message:"Enter your query or filters to start searching"}),filteringTitle:e.jsx(c,{message:"No results match your query or filters"})}),e.jsx(Fe,{query:s,onPageChange:v=>n(p=>(p.set("page",v.toString()),p)),onPerPageChange:v=>n(p=>(p.set("perPage",v.toString()),p))})]})}function ls(){const s=za(),[t,a]=d.useState([]);return e.jsxs(Xe,{query:s,children:[e.jsx(Ge,{query:s,selectedTickets:t,onSelectionChange:a}),e.jsx(ee,{children:t.length&&e.jsx(Ye,{ticketIds:t,onActionCompleted:()=>a([])})})]})}function Ma(){const[s]=q(),t={query:s.get("query")??"",page:s.get("page")??"1",perPage:s.get("perPage")??"20"};return J({queryKey:["users","search",t],queryFn:()=>qa(t),placeholderData:Oe,enabled:!!t.query})}function qa(s){return y.get("search/users",{params:s}).then(t=>t.data)}const Oa=[{key:"name",allowsSorting:!0,sortingKey:"email",width:"flex-3 min-w-200",visibleInMode:"all",header:()=>e.jsx(c,{message:"User"}),body:s=>e.jsx(Rt,{image:s.avatar,label:s.display_name,description:s.email})},{key:"roles",header:()=>e.jsx(c,{message:"Roles"}),body:s=>{var t;return e.jsx(we,{radius:"rounded",size:"xs",children:(t=s.roles)==null?void 0:t.map(a=>e.jsx(re,{selectable:!0,className:"capitalize",children:e.jsx(c,{message:a.name})},a.id))})}},{key:"createdAt",allowsSorting:!0,width:"w-96",header:()=>e.jsx(c,{message:"Created at"}),body:s=>e.jsx("time",{children:e.jsx(P,{date:s.created_at})})}];function $a(){var a;const s=R(),t=Ma();return e.jsx(Xe,{query:t,children:e.jsx(ze,{headerCellHeight:"h-36",cellHeight:"h-64",columns:Oa,data:((a=t.data)==null?void 0:a.pagination.data)||[],enableSelection:!1,onAction:n=>s(`/agent/users/${n.id}`)})})}const Ba=[{key:"name",width:"flex-3 min-w-200",visibleInMode:"all",header:()=>e.jsx(c,{message:"Article"}),body:s=>e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx(tt,{}),e.jsxs("div",{className:"min-w-0 overflow-hidden",children:[e.jsx("div",{className:"overflow-hidden overflow-ellipsis",children:s.title}),e.jsx(ys,{article:s,className:"text-xs text-muted"})]})]})},{key:"updated_at",allowsSorting:!0,width:"w-96",header:()=>e.jsx(c,{message:"Last updated"}),body:s=>e.jsx("time",{children:e.jsx(P,{date:s.updated_at})})}];function Ka(){var n;const s=R(),[t]=q(),a=ps(t.get("query")||"",{page:t.get("page")??"1",perPage:t.get("perPage")??"20",paginate:"lengthAware"},{disableDebounce:!0});return e.jsx(Xe,{query:a,children:e.jsx(ze,{headerCellHeight:"h-36",cellHeight:"h-64",columns:Ba,data:((n=a.data)==null?void 0:n.pagination.data)||[],enableSelection:!1,onAction:i=>s(fs(i))})})}const Ua=ce(e.jsx("path",{d:"M 5 5 L 5 6 L 5 26 L 5 27 L 6 27 L 20 27 L 20.40625 27 L 20.71875 26.71875 L 26.71875 20.71875 L 27 20.40625 L 27 20 L 27 6 L 27 5 L 26 5 L 6 5 L 5 5 z M 7 7 L 25 7 L 25 19 L 20 19 L 19 19 L 19 20 L 19 25 L 7 25 L 7 7 z M 21 21 L 23.5625 21 L 21 23.5625 L 21 21 z"}),"","0 0 32 32"),Qa=ce(e.jsx("path",{d:"M 8.28125 5.28125 L 2.28125 11.28125 L 1.59375 12 L 2.28125 12.71875 L 8.28125 18.71875 L 9.71875 17.28125 L 5.4375 13 L 23 13 C 25.754545 13 28 15.245455 28 18 C 28 20.754545 25.754545 23 23 23 L 20 23 L 20 25 L 23 25 C 26.845455 25 30 21.845455 30 18 C 30 14.154545 26.845455 11 23 11 L 5.4375 11 L 9.71875 6.71875 L 8.28125 5.28125 z M 8 23 L 8 25 L 10 25 L 10 23 L 8 23 z M 12 23 L 12 25 L 14 25 L 14 23 L 12 23 z M 16 23 L 16 25 L 18 25 L 18 23 L 16 23 z"}),"","0 0 32 32"),Ha={stay_on_page:h("Send and stay on page"),next_active_ticket:h("Send and next ticket"),back_to_folder:h("Send and back to folder")};function Ze(){const{tagId:s}=te(),{ticketId:t}=B(),a=zs(),{replies:n}=se(),i=R(),r=(n==null?void 0:n.after_reply_action)||"next_active_ticket",[l,o]=$e("after_reply_action",r),u=d.useCallback(async()=>{if(l==="next_active_ticket"){const m=await y.get(`tickets/${s}/next-active-ticket`);m!=null&&m.data.ticket&&(t===`${m.data.ticket.id}`?a():i(Ce(m.data.ticket,{tagId:s})))}else l==="back_to_folder"&&a()},[l,a,s,i]);return{action:l,setAction:o,perform:u}}function Va(){const{ticketId:s}=B();return L({mutationFn:t=>Wa(s,t),onSuccess:async()=>{await k.invalidateQueries({queryKey:["tickets",`${s}`]}),_(h("Note added"))},onError:t=>N(t)})}function Wa(s,t){return y.post(`tickets/${s}/notes`,t).then(a=>a.data)}function Ga(){const s=d.useRef(null),{close:t}=A(),a=Va(),[n,i]=d.useState([]),r=()=>{a.mutate({body:Le(s),attachments:n.map(l=>l.id)},{onSuccess:()=>t()})};return e.jsxs(Q,{size:"lg",children:[e.jsx(G,{children:e.jsx(c,{message:"Add a note"})}),e.jsx(H,{children:e.jsx(ye,{children:e.jsx(Te,{minHeight:"min-h-[300px]",isLoading:a.isPending,editorRef:s,className:"mb-24",attachments:n,onAttachmentsChange:l=>i(l),onSubmit:()=>r()})})}),e.jsxs(Z,{children:[e.jsx(g,{onClick:()=>t(),children:e.jsx(c,{message:"Cancel"})}),e.jsx(g,{variant:"flat",color:"primary",onClick:()=>r(),disabled:a.isPending,children:e.jsx(c,{message:"Add"})})]})]})}function Ya({ticket:s}){const t=ia(),{perform:a}=Ze();return e.jsxs("div",{className:"flex items-center gap-14 border-b py-4 pl-14 pr-20",children:[e.jsx(ae,{startIcon:e.jsx(Qa,{}),isCompact:!0,elementType:F,to:t,children:e.jsx(c,{message:"Back (b)"})}),e.jsx(Ms,{ticketIds:[s.id],isCompact:!0}),e.jsx(Ja,{}),e.jsx(Os,{ticketIds:[s.id],isCompact:!0}),e.jsx(qs,{ticketIds:[s.id],isCompact:!0,onSuccess:()=>a()}),e.jsxs("div",{className:"ml-auto text-2xl",children:["#",s.id]}),s.status&&e.jsx(re,{size:"sm",radius:"rounded",className:"font-bold capitalize",color:s.status==="open"?"primary":"chip",children:e.jsx(c,{message:s.status})})]})}function Ja(){const[s,t]=d.useState(!1);return U("window","n",()=>t(!0)),e.jsxs(X,{type:"modal",isOpen:s,onOpenChange:t,children:[e.jsx(ae,{startIcon:e.jsx(Ua,{}),isCompact:!0,children:e.jsx(c,{message:"Note (n)"})}),e.jsx(Ga,{})]})}function Xa(){return L({mutationFn:s=>Za(s),onSuccess:async(s,t)=>{await k.invalidateQueries({queryKey:["tickets",`${t.reply.ticket_id}`]})},onError:s=>N(s)})}function Za(s){return y.delete(`replies/${s.reply.id}`).then(t=>t.data)}function Bs(){return L({mutationFn:s=>en(s),onSuccess:async(s,t)=>{await k.invalidateQueries({queryKey:["tickets",`${t.reply.ticket_id}`,"replies"]})},onError:s=>N(s)})}function en({reply:s,...t}){return y.put(`replies/${s.id}`,t).then(a=>a.data)}function sn({reply:s}){var t;return(t=s.attachments)!=null&&t.length?e.jsx(As,{className:"mt-30 w-max",children:s.attachments.map((a,n)=>e.jsx(Ps,{attachments:s.attachments,index:n,onRemove:()=>{z(tn,{reply:s,attachment:a})}},a.id))}):null}function tn({reply:s,attachment:t}){const a=Bs(),{close:n}=A();return e.jsx(le,{isDanger:!0,title:e.jsx(c,{message:"Delete attachment"}),body:e.jsx(c,{message:"Are you sure you want to delete this attachment?"}),confirm:e.jsx(c,{message:"Delete"}),onConfirm:()=>{a.mutate({reply:s,attachments:s.attachments.filter(i=>i.id!==t.id).map(i=>i.id)},{onSuccess:n})},isLoading:a.isPending})}function an({reply:s}){const t=d.useRef(null),{close:a}=A(),n=Bs(),[i,r]=d.useState(s.attachments||[]),l=s.type==="notes"?e.jsx(c,{message:"Edit note"}):e.jsx(c,{message:"Edit reply"}),o=()=>{n.mutate({reply:s,body:Le(t),attachments:i.map(u=>u.id)},{onSuccess:()=>{a(),_(s.type==="notes"?h("Updated note"):h("Updated reply"))}})};return e.jsxs(Q,{size:"lg",children:[e.jsx(G,{children:l}),e.jsx(H,{children:e.jsx(ye,{children:e.jsx(Te,{minHeight:"min-h-[300px]",isLoading:n.isPending,initialContent:s.body,editorRef:t,attachments:i,onAttachmentsChange:u=>r(u),onSubmit:()=>o()})})}),e.jsxs(Z,{children:[e.jsx(g,{onClick:()=>a(),children:e.jsx(c,{message:"Cancel"})}),e.jsx(g,{variant:"flat",color:"primary",onClick:()=>o(),disabled:n.isPending,children:e.jsx(c,{message:"Save"})})]})]})}function nn(s){return J({queryKey:["original-email",`${s}`],queryFn:()=>rn(s),staleTime:1/0})}function rn(s){return y.get(`replies/${s}/original`).then(t=>t.data)}function cn({replyId:s}){var r;const{base_url:t}=se(),a=nn(s),[n,i]=d.useState("html");return e.jsxs(Q,{size:"fullscreen",className:"h-dialog",children:[e.jsx(G,{showDivider:!0,padding:"px-24 py-12",titleFontWeight:"font-normal",titleTextSize:"text-base",justify:"justify-start",actions:e.jsxs("div",{children:[e.jsxs(zt,{variant:"outline",radius:"rounded-md",size:"xs",value:n,onChange:i,children:[e.jsx(g,{value:"html",children:e.jsx(c,{message:"HTML"})}),e.jsx(g,{value:"plain",children:e.jsx(c,{message:"Plain"})}),e.jsx(g,{value:"headers",children:e.jsx(c,{message:"Headers"})})]}),e.jsx(g,{className:"ml-34",variant:"outline",size:"xs",elementType:"a",download:!0,href:`${t}/api/v1/replies/${s}/original/download`,children:e.jsx(c,{message:"Download"})})]}),children:e.jsx(c,{message:"Original email"})}),e.jsx(H,{children:(r=a.data)!=null&&r.email?e.jsx(ln,{data:a.data,activeTab:n}):e.jsx(on,{query:a})})]})}function ln({data:s,activeTab:t}){return t==="html"?e.jsx("div",{dangerouslySetInnerHTML:{__html:s.email.body.html}}):t==="plain"?e.jsx("pre",{className:"whitespace-pre-wrap break-words",children:s.email.body.plain}):e.jsx("table",{children:e.jsx("tbody",{children:Object.entries(s.email.headers).map(([a,n])=>e.jsxs("tr",{children:[e.jsx("th",{className:"whitespace-nowrap border px-20 py-10 text-left",children:a}),e.jsx("td",{className:"whitespace-nowrap border px-20 py-10 text-left",children:n})]},a))})})}function on({query:s}){return s.isLoading?e.jsx(at,{className:"absolute inset-0 m-auto"}):e.jsx(Me,{className:"mt-40",image:e.jsx("div",{children:e.jsx(nt,{size:"xl"})}),imageHeight:"h-auto",title:e.jsx(c,{message:"Original email for this reply does not exist"})})}function dn({data:{ticket:s,replies:t,draft:a}}){const n=E(l=>l.editorIsOpen),i=a&&!n,r=Cs(s.id,t);return e.jsxs("div",{children:[i&&e.jsx(Ae,{reply:a,className:"pl-20 pr-8",actions:e.jsx(os,{reply:a}),ticketRequestType:s.ticket_request_type}),r.items.map(l=>{var u;const o=!r.hasNextPage&&l.id===((u=r.items.at(-1))==null?void 0:u.id);return e.jsx(Ae,{className:"pl-20 pr-8",reply:l,isInitial:o,actions:e.jsx(os,{reply:l}),attachments:e.jsx(sn,{reply:l}),ticketRequestType:s.ticket_request_type},l.id)}),e.jsx(Ve,{query:r})]})}function os({reply:s}){return e.jsxs(O,{children:[e.jsx(D,{className:"text-muted",size:"sm",children:e.jsx(Et,{})}),e.jsxs($,{children:[e.jsx(j,{value:"edit",onClick:()=>z(an,{reply:s}),children:e.jsx(c,{message:"Edit"})}),s.type==="replies"&&e.jsx(j,{value:"showOriginal",onClick:()=>z(cn,{replyId:s.id}),children:e.jsx(c,{message:"Show original"})}),e.jsx(j,{value:"delete",onClick:()=>z(un,{reply:s}),children:e.jsx(c,{message:"Delete"})})]})]})}function un({reply:s}){const t=Xa();let a=e.jsx(c,{message:"Delete reply"}),n=e.jsx(c,{message:"Are you sure you want to delete this reply?"});return s.type==="notes"&&(a=e.jsx(c,{message:"Delete note"}),n=e.jsx(c,{message:"Are you sure you want to delete this note?"})),e.jsx(le,{isDanger:!0,title:a,body:n,confirm:e.jsx(c,{message:"Delete"}),onConfirm:()=>t.mutate({reply:s},{onSuccess:()=>it()}),isLoading:t.isPending})}function mn(){return L({mutationFn:s=>xn(s),onSuccess:(s,t)=>{k.invalidateQueries({queryKey:["mailbox","sidenav-tags"]}),t.ticketIds.forEach(a=>{rt(a,n=>{var i;n.ticket.tags=(i=n.ticket.tags)==null?void 0:i.filter(r=>r.id!==t.tagId)})})},onError:s=>N(s)})}function xn(s){return y.post("tickets/tags/remove",s).then(t=>t.data)}const hn={month:"short",day:"numeric"};function Ks({ticket:s,actions:t,children:a}){return e.jsx(d.Fragment,{children:e.jsxs("div",{className:"flex items-start gap-12 px-20 py-14 max-md:flex-col md:items-center",children:[e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx("h1",{className:"text-2xl",children:s.subject}),e.jsx(Ls,{ticketRequestType:s.ticket_request_type})]}),a,e.jsx("div",{className:"mr-24 max-md:hidden"}),e.jsxs("div",{className:"whitespace-nowrap text-muted md:ml-auto",children:[e.jsx(Re,{date:s.created_at})," (",e.jsx(P,{date:s.created_at,options:hn}),")"]}),t]})})}function Us({ticket:s,onRemoveTag:t,tagType:a,size:n="xs",...i}){var r,l;return(r=s.tags)!=null&&r.length?e.jsx(we,{...i,size:n,selectable:!!t,children:(l=s.tags)==null?void 0:l.filter(o=>o.type!=="status"&&(!a||o.type===a)).map(o=>e.jsx(re,{onRemove:t?()=>t(o):void 0,children:o.display_name},o.id))}):null}function gn({data:{ticket:s}}){const t=mn(),a=E(r=>r.editorIsOpen),n=Ut(),i=r=>{t.mutate({ticketIds:[s.id],tagId:r.id})};return U("window","r",()=>{a||n()}),e.jsx(Ks,{ticket:s,actions:s.status!=="locked"&&e.jsx(g,{variant:"outline",size:"xs",onClick:()=>n(),startIcon:e.jsx(aa,{}),disabled:a,children:e.jsx(c,{message:"Reply"})}),children:e.jsx(Us,{ticket:s,onRemoveTag:i})})}function es({label:s,children:t,name:a,className:n}){const[i,r]=$e(a,!0);return e.jsxs("section",{className:w("border-b pb-14 text-sm",n),children:[e.jsxs("div",{className:"flex items-center justify-between gap-14 px-14",children:[e.jsx("div",{className:"font-semibold",children:s}),e.jsx(D,{onClick:()=>r(!i),className:w("transition-transform",i&&"rotate-180"),children:e.jsx(pe,{})})]}),i&&e.jsx("div",{className:"pt-8",children:t})]})}function jn({purchaseCode:s}){const{close:t}=A(),a=ct();return e.jsxs(Q,{size:"md",children:[e.jsx(H,{children:e.jsxs("div",{className:"flex items-start gap-14 text-sm",children:[e.jsx("img",{src:s.image,alt:"",className:"h-80 w-80 flex-shrink-0 rounded"}),e.jsxs("div",{className:"flex-auto",children:[e.jsx("a",{href:s.url,target:"_blank",rel:"noreferrer",className:lt,children:s.item_name}),e.jsx("div",{className:"mt-4 text-sm text-muted",children:s.code}),e.jsxs("div",{className:"mt-12",children:[e.jsx(ge,{label:e.jsx(c,{message:"Customer"}),value:s.envato_username}),e.jsx(ge,{label:e.jsx(c,{message:"Purchased"}),value:e.jsx(P,{date:s.purchased_at})}),e.jsx(ge,{label:e.jsx(c,{message:"Supported until"}),value:e.jsx(P,{date:s.supported_until})}),e.jsx(ge,{label:e.jsx(c,{message:"Last synced"}),value:e.jsx(P,{date:s.updated_at})})]})]})]})}),e.jsxs(Z,{children:[e.jsx(g,{onClick:()=>t(),children:e.jsx(c,{message:"Cancel"})}),e.jsx(g,{variant:"flat",color:"primary",disabled:a.isPending,onClick:()=>a.mutate({userId:s.user_id}),children:e.jsx(c,{message:"Sync purchases"})})]})]})}function ge({label:s,value:t}){return e.jsxs("div",{className:"mb-6 flex items-center gap-14",children:[e.jsxs("div",{children:[s,":"]}),e.jsx("div",{className:"text-muted",children:t})]})}function Qs({purchases:s,itemClassName:t,activePurchase:a}){return e.jsx("div",{children:s.map(n=>e.jsxs(X,{type:"modal",children:[e.jsxs("div",{className:w("flex cursor-pointer items-center gap-8 rounded py-8 hover:bg-hover",t,(a==null?void 0:a.code)===n.code&&"bg-primary-light/30"),children:[e.jsx("img",{src:n.image,alt:"",className:"h-30 w-30 rounded"}),e.jsxs("div",{className:"min-w-0 text-xs",children:[e.jsx("div",{className:"overflow-hidden overflow-ellipsis whitespace-nowrap",children:n.item_name}),e.jsx("div",{className:w("text-muted",n.support_expired&&"line-through"),children:n.supported_until?e.jsx(P,{date:n.supported_until}):n.support_expired?e.jsx(c,{message:"Support expired"}):"-"})]})]}),e.jsx(jn,{purchaseCode:n})]},n.id))})}function pn({user:s,ticket:t}){const a=d.useMemo(()=>{var r,l,o,u;const n=(l=(r=t.tags)==null?void 0:r.find(m=>m.type!=="status"))==null?void 0:l.categories[0];let i;if(n){const m=n.name.toLowerCase();i=(o=s.purchase_codes)==null?void 0:o.find(v=>v.item_name.toLowerCase().indexOf(m)>-1)}return i||((u=s.purchase_codes)==null?void 0:u[0])},[s,t]);return e.jsx(es,{label:e.jsx(c,{message:"Envato"}),name:"purchase-list-visible",children:e.jsxs("div",{className:"overflow-hidden",children:[a&&e.jsxs("div",{className:"mb-8 flex items-center gap-4 px-14 text-sm",children:[e.jsx(ot,{size:"sm"}),e.jsx("a",{href:`https://codecanyon.net/user/${a.envato_username}`,target:"_blank",rel:"noreferrer",children:a.envato_username})]}),e.jsx(Qs,{purchases:s.purchase_codes||[],itemClassName:"px-14",activePurchase:a})]})})}function fn(s){return Qt({queryKey:["activity-log"],endpoint:"activity-log",paginate:"simple",queryParams:s})}const yn="article",bn="search_term";function vn({children:s,className:t}){const a=d.Children.toArray(s);return e.jsx("div",{className:t,children:a.map((n,i)=>d.cloneElement(n,{isLast:i===a.length-1}))})}function kn({children:s,className:t,isLast:a}){return e.jsxs("div",{className:w("flex gap-12",t),children:[e.jsxs("div",{children:[e.jsx("div",{className:"mt-4 h-12 w-12 flex-shrink-0 rounded-full border-[3px]"}),!a&&e.jsx("div",{className:"mx-auto mt-4 h-[calc(100%-12px)] w-1 bg-chip"})]}),e.jsx("div",{className:"flex-auto",children:s})]})}const Sn={hour:"numeric",minute:"numeric"};function wn({ticket:s}){const t=s.user.id,a=fn({userId:t}),n=e.jsx(W.div,{className:"px-14 py-6",...Y,children:Array.from({length:5}).map((r,l)=>e.jsx(qe,{className:"min-h-48"},l))},"skeletons"),i=e.jsxs(d.Fragment,{children:[e.jsx(W.div,{...Y,children:e.jsx(vn,{children:a.items.map(r=>{var l;return e.jsxs(kn,{className:w("px-14 py-6",r.event==="created"&&((l=r.subject)==null?void 0:l.id)===s.id&&"bg-primary/8"),children:[e.jsx(Tn,{activity:r}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-muted",children:[e.jsx(Re,{date:r.created_at}),e.jsx("div",{children:"•"}),e.jsx(P,{date:r.created_at,options:Sn})]})]},r.id)})})},"timeline"),e.jsx(Ve,{query:a,size:"sm"})]});return e.jsx(es,{label:e.jsx(c,{message:"Activity"}),name:"activity-visible",className:"mt-10",children:e.jsx(ee,{initial:!1,mode:"wait",children:a.isLoading?n:i})})}function Tn({activity:s}){var t;switch((t=s.subject)==null?void 0:t.model_type){case yn:return e.jsx(c,{message:"Viewd article: :link",values:{link:e.jsx(dt,{target:"_blank",className:"font-semibold",article:s.subject})}});case ma:return e.jsx(Ln,{activity:s});case bn:const a=s.subject.term;return e.jsx(c,{message:"Search for: :link",values:{link:e.jsx(F,{target:"_blank",className:"font-semibold",to:`/hc/search?query=${a}`,children:a})}});default:return null}}function Ln({activity:s}){var a,n,i,r;const t=e.jsx(oa,{target:"_blank",className:"font-semibold",ticket:s.subject});return s.event==="replied"?((a=s.properties)==null?void 0:a.source)==="email"?e.jsx(c,{message:"Replied via email: :link",values:{link:t}}):e.jsx(c,{message:"Replied via website: :link",values:{link:t}}):s.event==="created"?e.jsx(c,{message:"Created ticket: :link",values:{link:t}}):s.event==="articlesSuggested"?e.jsx(c,{message:'Suggested :count articles for ":query"',values:{count:((i=(n=s.properties)==null?void 0:n.articleIds)==null?void 0:i.length)||1,query:(r=s.properties)==null?void 0:r.query}}):null}function Cn(){const{ticketId:s}=B();return L({mutationFn:t=>Nn({...t,ticketId:s}),onSuccess:async()=>{await k.invalidateQueries({queryKey:["tickets"]}),_(h("Merged tickets"))},onError:t=>N(t)})}function Nn(s){return y.post("tickets/merge",s).then(t=>t.data)}function In({ticketId:s}){var a,n;const t=Be(s);return e.jsxs(Q,{size:"fullscreen",className:"h-dialog",children:[e.jsx(G,{showDivider:!0,padding:"px-24 py-12",titleFontWeight:"font-normal",titleTextSize:"text-base",justify:"justify-start",actions:(a=t.data)!=null&&a.ticket?e.jsx(Dn,{ticket:(n=t.data)==null?void 0:n.ticket}):null,children:e.jsx(c,{message:"Ticket preview"})}),e.jsx(H,{className:"bg",padding:"p-0",children:t.data?e.jsx(An,{data:t.data}):e.jsx(be,{query:t,loaderClassName:"absolute inset-0 m-auto"})})]})}function Dn({ticket:s}){const{close:t}=A();return e.jsxs(d.Fragment,{children:[e.jsx(g,{elementType:F,to:Ce(s),variant:"outline",size:"xs",children:e.jsx(c,{message:"Open ticket"})}),e.jsxs(X,{type:"modal",onClose:a=>{a&&t()},children:[e.jsx(g,{variant:"outline",size:"xs",className:"mr-48",children:e.jsx(c,{message:"Merge"})}),e.jsx(_n,{ticket:s})]})]})}function _n({ticket:s}){const t=Cn(),{close:a}=A();return e.jsx(le,{title:e.jsx(c,{message:"Merge tickets"}),isLoading:t.isPending,onConfirm:()=>{t.mutate({mergeeId:s.id},{onSuccess:n=>a(n.ticket)})},body:e.jsxs("div",{children:[e.jsx(c,{message:"Please confirm you'd like to merge this ticket with the original one behind the popup."}),e.jsx("p",{className:"mt-12 font-semibold",children:e.jsx(c,{message:"Merged tickets cannot be unmerged."})})]}),confirm:e.jsx(c,{message:"Merge"})})}function An({data:s}){return e.jsxs("div",{children:[e.jsx(Ks,{ticket:s.ticket,children:e.jsx(Us,{ticket:s.ticket})}),e.jsx(Pn,{data:s})]})}function Pn({data:{ticket:s,replies:t}}){const a=Cs(s.id,t);return e.jsxs(d.Fragment,{children:[a.items.map(n=>{var r,l;const i=!a.hasNextPage&&n.id===((r=a.items.at(-1))==null?void 0:r.id);return e.jsx(Ae,{reply:n,isInitial:i,className:"px-20",ticketRequestType:s.ticket_request_type,attachments:(l=n.attachments)!=null&&l.length?e.jsx(Fn,{attachments:n.attachments}):null},n.id)}),e.jsx(Ve,{query:a})]})}function Fn({attachments:s}){return e.jsx(As,{className:"mt-30 w-max",children:s.map((t,a)=>e.jsx(Ps,{attachments:s,index:a},t.id))})}function Rn(s,t){return L({mutationFn:a=>zn(s,a),onSuccess:async()=>{await k.invalidateQueries({queryKey:["tickets"]})},onError:a=>t?Ke(a,t):N(a)})}function zn(s,t){return y.put(`tickets/${s}`,t).then(a=>a.data)}function En({ticketId:s}){const{close:t,formId:a}=A(),n=ve(),i=Rn(s,n);return e.jsxs(Q,{children:[e.jsx(G,{children:e.jsx(c,{message:"Change customer"})}),e.jsx(H,{children:e.jsx(ke,{id:a,form:n,onSubmit:r=>{i.mutate(r,{onSuccess:()=>t()})},children:e.jsx(Qe,{required:!0,name:"user_id",endpoint:"normalized-models/user",label:e.jsx(c,{message:"New customer"})})})}),e.jsxs(Z,{children:[e.jsx(g,{onClick:()=>t(),children:e.jsx(c,{message:"Cancel"})}),e.jsx(g,{type:"submit",form:a,variant:"flat",color:"primary",disabled:i.isPending,children:e.jsx(c,{message:"Change"})})]})]})}function Mn({className:s}){const{tickets:t}=se(),{data:a}=Be();return e.jsx("div",{className:w(s,"compact-scrollbar stable-scrollbar overflow-y-auto border-l"),children:(a==null?void 0:a.ticket.user)&&e.jsxs(d.Fragment,{children:[e.jsx(qn,{ticket:a.ticket}),e.jsx(On,{ticket:a.ticket}),(t==null?void 0:t.log_activity)&&e.jsx(wn,{ticket:a.ticket})]})})}function qn({ticket:s}){var i,r;const t=s.user,{envato:a}=se(),n=Pe(t.id);return e.jsxs("div",{className:"py-14",children:[e.jsx(F,{to:n,target:"_blank",children:e.jsx(He,{user:t,size:"xl",circle:!0,className:"mx-auto"})}),e.jsxs("section",{className:"mb-14 border-b px-14 pb-14 text-muted",children:[e.jsxs("div",{className:"mt-10 flex items-center justify-between gap-14 text-muted",children:[e.jsx("div",{children:t.display_name}),e.jsxs(O,{children:[e.jsx(D,{size:"sm",children:e.jsx(ms,{})}),e.jsxs($,{children:[e.jsx(j,{value:"edit",elementType:F,to:n,target:"_blank",children:e.jsx(c,{message:"Edit"})}),e.jsx(j,{value:"changeCustomer",onSelected:()=>z(En,{ticketId:s.id}),children:e.jsx(c,{message:"Change customer"})})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(ea,{size:"xs"}),e.jsx("div",{className:"text-sm",children:t.email})]}),!!((i=t.tags)!=null&&i.length)&&e.jsx(we,{size:"xs",className:"mt-14",children:(r=t.tags)==null?void 0:r.map(l=>e.jsx(re,{children:l.display_name},l.id))})]}),a.enable&&e.jsx(pn,{user:t,ticket:s})]})}function On({ticket:s}){const t=s.user,{data:a,isLoading:n}=Ee({userId:t.id,perPage:6,paginate:"simple"}),i=e.jsx(W.div,{...Y,children:Array.from({length:5}).map((l,o)=>e.jsx(qe,{className:"min-h-24"},o))},"skeletons"),r=e.jsx(W.div,{...Y,children:a==null?void 0:a.pagination.data.filter(l=>l.id!==s.id).map(l=>e.jsxs(X,{type:"modal",children:[e.jsx(ut,{display:"block",className:w("block min-w-0 max-w-full overflow-hidden text-ellipsis pb-4 text-sm hover:underline",l.closed_at&&"text-muted"),children:l.subject}),e.jsx(In,{ticketId:l.id})]},l.id))},"tickets");return e.jsx(es,{label:e.jsx(c,{message:"Other tickets"}),name:"other-tickets",children:e.jsx(ee,{initial:!1,mode:"wait",children:e.jsx("div",{className:"space-y-10 px-14",children:n?i:r})})})}function Hs(){const s=B(),{updateActiveDraft:t,setEditorIsOpen:a}=E();return L({mutationFn:n=>{t({isSaving:!0});const i=n.ticketId||s.ticketId;return $n(n.draft,i)},onSuccess:async(n,i)=>{if(i.type!=="background"){const r=i.ticketId||s.ticketId;await k.invalidateQueries({queryKey:["tickets",`${r}`]}),a(!1)}t({isDirty:!1,id:n.reply.id})},onError:n=>N(n),onSettled:()=>{t({isSaving:!1})}})}function $n(s,t){const a={body:s.body,attachments:s.attachments.map(i=>i.id)};return(s.id?y.put(`replies/${s.id}`,a):y.post(`tickets/${t}/drafts`,a)).then(i=>i.data)}function Vs(){const s=Hs();return d.useCallback((t="background",a)=>{b().activeDraft.isDirty&&!b().activeDraft.isSaving&&!b().ticketIsSaving&&s.mutate({ticketId:a,draft:b().activeDraft,type:t})},[s])}function Bn(){const{ticketId:s}=B(),{perform:t,action:a}=Ze(),n=Ns({clearTicketCache:!1}),{setTicketIsSaving:i}=E();return L({mutationFn:r=>(i(!0),Kn({ticketId:s,...r})),onSuccess:async()=>{k.invalidateQueries({queryKey:["mailbox","sidenav-tags"]}),b().activeDraft.id&&n.mutate({id:b().activeDraft.id}),b().discardActiveDraft(),await Promise.allSettled([k.invalidateQueries({queryKey:["tickets"],predicate:r=>a==="stay_on_page"||!Un(r,s)}),t()]),_(h("Reply submitted"))},onError:r=>N(r),onSettled:()=>i(!1)})}function Kn(s){return y.post(`tickets/${s.ticketId}/${s.type}`,s).then(t=>t.data)}function Un(s,t){const a=s.queryKey[0]==="tickets"&&s.queryKey[1]===`${t}`,n=s.queryKey[0]==="tickets"&&typeof s.queryKey[1]=="object"&&s.queryKey[1]&&"userId"in s.queryKey[1];return a||n}function Qn({size:s="sm"}){const t=E(u=>u.activeDraft.isDirty),a=E(u=>u.activeDraft.isSaving),n=E(u=>{var m;return!u.activeDraft.body&&!((m=u.activeDraft.attachments)!=null&&m.length)}),i=Hs(),r=Ns(),l=()=>{i.mutate({draft:b().activeDraft,type:"manual"})},o=d.useCallback(()=>{b().activeDraft.id?r.mutate({id:b().activeDraft.id},{onSuccess:()=>b().setEditorIsOpen(!1)}):b().setEditorIsOpen(!1)},[r]);return U("window","Escape",()=>{b().editorIsOpen&&o()}),e.jsxs(d.Fragment,{children:[e.jsx(ie,{label:e.jsx(c,{message:"Save draft"}),children:e.jsx(D,{className:"ml-auto",size:s,color:t?null:"positive",onClick:l,disabled:a||n,children:e.jsx(mt,{})})}),e.jsx(ie,{label:e.jsx(c,{message:"Discard (Esc)"}),children:e.jsx(D,{size:s,disabled:a,onClick:o,children:e.jsx(vs,{})})})]})}function Hn(s=""){const{user:t}=bs();return J({queryKey:["canned-replies",`${t==null?void 0:t.id}`,s],queryFn:({signal:a})=>Vn(t.id,s,a),placeholderData:Oe})}async function Vn(s,t,a){return t&&await new Promise(n=>setTimeout(n,300)),y.get("canned-replies",{params:{userId:s,shared:!0,perPage:15,query:t},signal:a}).then(n=>n.data)}function Wn({onSelected:s,size:t}){const{trans:a}=fe(),[n,i]=d.useState(""),{data:r,isFetching:l}=Hn(n);return e.jsxs(O,{isAsync:!0,searchPlaceholder:a(h("Search...")),isLoading:l,inputValue:n,onInputValueChange:i,clearInputOnItemSelection:!0,blurReferenceOnItemSelection:!0,selectionMode:"none",showSearchField:!0,floatingMaxHeight:440,floatingMinWidth:"min-w-288",showEmptyMessage:!0,children:[e.jsx(ie,{label:e.jsx(c,{message:"Saved replies"}),children:e.jsx(D,{size:t,children:e.jsx(sa,{})})}),e.jsxs($,{children:[e.jsx(j,{value:"saveThisReply",className:"font-semibold",onSelected:()=>z(Mt),children:e.jsx(c,{message:"Save this reply..."})}),r==null?void 0:r.pagination.data.map(o=>e.jsx(j,{value:o.id,onSelected:()=>s(o),children:o.name},o.id))]})]})}function Gn({onSelected:s}){const t=xt(),a=d.useRef(null),[n,i]=d.useState(""),{data:r,isFetching:l}=ps(n,{categoryIds:t}),{trans:o}=fe();return U("window","ctrl+/",()=>{var u;(u=a.current)==null||u.focus()},{allowedInputSelector:".ProseMirror"}),e.jsx(ds,{inputValue:n,onInputValueChange:i,isAsync:!0,isLoading:l,items:r==null?void 0:r.pagination.data,clearInputOnItemSelection:!0,hideEndAdornment:!0,placeholder:o(h("Search documentation... (ctrl+/)")),startAdornment:e.jsx(hs,{}),className:"mb-10",selectionMode:"none",showEmptyMessage:!0,ref:a,children:u=>e.jsx(j,{value:u.id,onSelected:()=>{close(),s(u)},description:e.jsx(ys,{article:u}),textLabel:u.title,children:u.title},u.id)})}function Yn(){var l;const{addGlobalListener:s}=ht(),t=Bn(),a=E(o=>o.activeDraft.attachments),n=d.useRef(null),i=d.useCallback(()=>{n.current&&t.mutate({type:"replies",status:gt("ticket-page-status","pending"),attachments:b().activeDraft.attachments.map(o=>o.id),body:Le(n)},{onSuccess:()=>{b().setEditorIsOpen(!1)}})},[t]),r=Vs();return d.useEffect(()=>{s(document,"visibilitychange",()=>{document.hidden&&r()})},[s,r]),e.jsxs("div",{className:"mb-24 px-20",children:[e.jsx(Gn,{onSelected:o=>{n.current&&ta(n.current,{href:fs(o),target:"_blank",text:o.title})}}),e.jsx(Te,{menubarButtons:e.jsx(Jn,{editorRef:n}),footerButtons:e.jsx(Xn,{}),attachments:a,onAttachmentsChange:o=>{b().updateActiveDraft({attachments:o})},editorRef:n,onSubmit:i,isLoading:t.isPending,initialContent:(l=b().activeDraft)==null?void 0:l.body,onChange:()=>{n.current&&b().updateActiveDraft({body:n.current.getHTML()})}})]})}function Jn({size:s,editorRef:t}){return e.jsxs(d.Fragment,{children:[e.jsx(Wn,{size:s,onSelected:a=>{var n;b().updateActiveDraft({body:a.body,attachments:a.attachments}),(n=t.current)==null||n.commands.insertContent(a.body)}}),e.jsx(Qn,{size:s})]})}function Xn({isLoading:s,onSubmit:t}){return e.jsxs(d.Fragment,{children:[e.jsx(ei,{}),e.jsx(Ht,{isLoading:s,onSubmit:t}),e.jsx(Zn,{disabled:s})]})}function Zn({disabled:s}){const{action:t,setAction:a}=Ze();return e.jsxs(O,{selectionMode:"single",selectedValue:t,onItemSelected:n=>a(n),children:[e.jsx(D,{border:"border border-transparent border-l-primary-light/40",variant:"flat",color:"primary",radius:"rounded-none",size:"sm",disabled:s,children:e.jsx(jt,{})}),e.jsx($,{children:Object.entries(Ha).map(([n,i])=>e.jsx(j,{value:n,capitalizeFirst:!0,children:e.jsx(c,{...i})},n))})]})}function ei(){const{data:s}=oe(),[t,a]=$e("ticket-page-status","pending");if(!(s!=null&&s.statusTags.length))return null;const n=s.statusTags.find(i=>i.name===t);return e.jsxs(O,{selectionMode:"single",selectedValue:t,onItemSelected:i=>a(i),children:[e.jsx(g,{radius:"rounded-none",endIcon:e.jsx(pe,{}),className:"capitalize text-muted",children:e.jsx(c,{message:n.display_name})}),e.jsx($,{children:s.statusTags.map(i=>e.jsx(j,{value:i.name,capitalizeFirst:!0,children:e.jsx(c,{message:i.display_name})},i.id))})]})}function si(){return e.jsx(Ne,{rightSidenav:e.jsx(We,{position:"right",className:"bg-alt",size:"w-264",children:e.jsx(Mn,{})}),children:e.jsx(ti,{})})}function ti(){var i;const{branding:s}=se(),t=Be(),a=Gt((i=t.data)==null?void 0:i.ticket.id),n=Vs();return d.useEffect(()=>{var l,o;const r=(l=t.data)==null?void 0:l.ticket;if(r){const u=(o=r.replies)==null?void 0:o.find(m=>m.type==="drafts");u&&a!==r.id&&b().updateActiveDraft({...Vt,...u,isDirty:!1})}return()=>{a&&(n("manual",a),b().setEditorIsOpen(!1))}},[a]),e.jsx(d.Fragment,{children:t.data?e.jsxs(d.Fragment,{children:[e.jsx(pt,{children:e.jsxs("title",{children:[t.data.ticket.subject," - ",s.site_name]})}),e.jsx(Ya,{ticket:t.data.ticket}),e.jsx(gn,{data:t.data}),e.jsx(ai,{}),e.jsx(dn,{data:t.data})]}):e.jsx(be,{query:t,loaderClassName:"absolute inset-0 m-auto",redirectOn404:"/agent/tickets"})})}function ai(){const s=E(t=>t.editorIsOpen);return e.jsx(ye,{children:s&&e.jsx(Yn,{})})}function ni(){const{user:s}=bs();return e.jsx(Ne,{children:e.jsx(qt,{userId:s==null?void 0:s.id})})}function ii(){const s=oe();return e.jsx(Ne,{children:e.jsxs("main",{className:"container mx-auto p-12 md:p-24",children:[e.jsx("h1",{className:"mb-34 mt-14 text-3xl font-light",children:e.jsx(c,{message:"Create new ticket"})}),s.data?e.jsx(ri,{tags:s.data}):e.jsx(be,{query:s,show404:!1,loaderIsScreen:!1})]})})}function ri({tags:{statusTags:s,categoryTags:t}}){var f,K,I;const a=R(),[n]=q(),i=n.get("customer_id"),r=ve({defaultValues:{category_id:(f=t[0])==null?void 0:f.id,status:(K=s[0])==null?void 0:K.name,user_id:i?parseInt(i):void 0}}),l=(I=r.formState.errors.body)==null?void 0:I.message,o=Wt(r),u=d.useRef(null),[m,v]=d.useState([]),p=()=>{o.mutate({...r.getValues(),body:Le(u)||"",attachments:m.map(x=>x.id),created_by_agent:!0},{onSuccess:()=>a("/agent/tickets")})},S=ft();return e.jsxs(ke,{form:r,onSubmit:()=>p(),onBeforeSubmit:()=>r.clearErrors(),children:[e.jsx(Qe,{name:"user_id",endpoint:"normalized-models/user",label:e.jsx(c,{message:"Customer"}),className:"mb-24",autoFocus:!0}),e.jsx(Se,{name:"subject",label:e.jsx(c,{message:"Subject"}),className:"mb-24"}),e.jsx(je,{name:"category_id",label:e.jsx(c,{message:"Category"}),selectionMode:"single",className:"mb-24",children:t.map(x=>e.jsx(j,{value:x.id,children:x.display_name||x.name},x.id))}),e.jsx(je,{name:"status",label:e.jsx(c,{message:"Status"}),selectionMode:"single",className:"mb-24",children:s.map(x=>e.jsx(j,{value:x.name,children:x.display_name||x.name},x.id))}),e.jsxs("div",{className:"mb-24",children:[e.jsx("div",{className:S.label,children:e.jsx(c,{message:"Reply body"})}),e.jsx(ye,{children:e.jsx(Te,{autoFocus:!1,minHeight:"min-h-[300px]",isLoading:o.isPending,editorRef:u,attachments:m,onAttachmentsChange:x=>v(x),onSubmit:()=>p()})}),l&&e.jsx("div",{className:S.error,children:l})]}),e.jsx(g,{variant:"flat",color:"primary",type:"submit",disabled:o.isPending,children:e.jsx(c,{message:"Create"})})]})}function ci(s,t){return L({mutationFn:a=>li(s,a),onSuccess:async()=>{t.reset({},{keepValues:!0}),await k.invalidateQueries({queryKey:["users"]}),_(h("User details updated"))},onError:a=>t?Ke(a,t):N(a)})}function li(s,t){return y.put(`users/${s}/details`,t).then(a=>a.data)}const V="border border-fg-base/6 hover:border-divider";function oi({user:s,className:t}){const{envato:a}=se();return e.jsxs("aside",{className:t,children:[s&&e.jsx(di,{user:s}),a.enable&&!!(s!=null&&s.purchase_codes)&&e.jsxs(d.Fragment,{children:[e.jsx("div",{className:"mb-4 mt-24 text-lg font-semibold",children:e.jsx(c,{message:"Envato purchases"})}),e.jsx(Qs,{purchases:s.purchase_codes})]})]})}function di({user:s}){var n,i,r;const t=ve({defaultValues:{language:s.language||"",country:s.country||"",timezone:s.timezone||yt(),notes:((n=s.details)==null?void 0:n.notes)||"",details:((i=s.details)==null?void 0:i.details)||"",emails:s.secondary_emails,tags:(r=s.tags)==null?void 0:r.map(l=>l.name)}}),a=ci(s.id,t);return e.jsxs(ke,{form:t,onSubmit:l=>a.mutate(l),children:[e.jsxs("div",{className:"space-y-12",children:[e.jsx(ui,{user:s}),e.jsx(mi,{user:s}),e.jsx(M,{label:e.jsx(c,{message:"Tags"}),children:e.jsx(Ot,{name:"tags",size:"sm",chipSize:"xs",valueKey:"name",inputBorder:V})}),e.jsx(xi,{}),e.jsx(hi,{}),e.jsx(M,{label:e.jsx(c,{message:"Last login"}),children:s.last_login?e.jsx(P,{date:s.last_login.created_at}):"-"}),e.jsx(M,{label:e.jsx(c,{message:"Created at"}),children:s.created_at?e.jsx(P,{date:s.created_at}):"-"})]}),t.formState.isDirty&&e.jsx(g,{color:"primary",variant:"flat",type:"submit",size:"sm",display:"block",className:"mt-14 w-full",disabled:a.isPending,children:e.jsx(c,{message:"Save"})})]})}function ui({user:s}){const{fields:t,append:a,remove:n}=bt({name:"emails",keyName:"key"});return e.jsx(M,{label:e.jsx("div",{className:"mt-4",children:e.jsx(c,{message:"Emails"})}),align:"items-start",children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between gap-12",children:[e.jsx("div",{className:"min-w-0 flex-auto overflow-hidden overflow-ellipsis whitespace-nowrap",children:s.email}),e.jsx(ie,{label:e.jsx(c,{message:"Add email"}),children:e.jsx(D,{size:"xs",iconSize:"sm",onClick:()=>a({address:""}),children:e.jsx(ws,{})})})]}),e.jsx("div",{className:"space-y-4 pt-6",children:t.map((i,r)=>e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx(Se,{name:`emails.${r}.address`,className:"flex-auto",size:"xs",type:"email",inputBorder:V}),e.jsx(D,{color:"danger",size:"xs",iconSize:"sm",onClick:()=>n(r),children:e.jsx(vt,{})})]},i.key))})]})})}function mi({user:s}){const{trans:t}=fe(),{data:a}=kt(["timezones","countries","localizations"]),n=(a==null?void 0:a.countries)||[],i=(a==null?void 0:a.localizations)||[],r=(a==null?void 0:a.timezones)||{};return e.jsxs(d.Fragment,{children:[e.jsx(M,{label:e.jsx(c,{message:"Timezone"}),children:e.jsx(St,{name:"timezone",timezones:r,size:"sm",inputBorder:V})}),e.jsx(M,{label:e.jsx(c,{message:"Language"}),children:e.jsx(je,{selectionMode:"single",name:"language",size:"sm",inputBorder:V,children:i.map(l=>e.jsx(j,{value:l.language,children:l.name},l.language))})}),e.jsx(M,{label:e.jsx(c,{message:"Country"}),children:e.jsx(je,{selectionMode:"single",size:"sm",name:"country",showSearchField:!0,searchPlaceholder:t(h("Search countries")),inputBorder:V,children:n.map(l=>e.jsx(j,{value:l.code,children:l.name},l.code))})})]})}function xi(){return e.jsx(M,{label:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{children:e.jsx(c,{message:"Details"})}),e.jsx(Ts,{dialogSize:"xs",body:e.jsx(c,{message:"Optional information, like address. Only visible to agents, not end users."})})]}),children:e.jsx(Se,{name:"details",inputElementType:"textarea",rows:1,inputBorder:V})})}function hi(){return e.jsx(M,{label:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{children:e.jsx(c,{message:"Notes"})}),e.jsx(Ts,{dialogSize:"xs",body:e.jsx(c,{message:"Optional notes. Only visible to agents, not end users."})})]}),children:e.jsx(Se,{name:"notes",inputElementType:"textarea",rows:1,inputBorder:V})})}function M({label:s,children:t,align:a="items-center"}){return e.jsxs("div",{className:`flex ${a} gap-12`,children:[e.jsx("div",{className:"w-80 flex-shrink-0 text-sm text-muted",children:s}),e.jsx("div",{className:"flex-auto text-sm",children:t})]})}function gi(){const s=R();return L({mutationFn:ji,onSuccess:async()=>{_(h("User deleted")),await Promise.allSettled([k.invalidateQueries({queryKey:["users"]}),k.invalidateQueries({queryKey:["tickets"]})]),s("/agent/tickets")},onError:t=>N(t)})}function ji(s){return y.delete(`users/${s.userId}`).then(t=>t.data)}function pi(s){const t=R();return L({mutationFn:fi,onSuccess:async()=>{_(h("Users merged")),await Promise.allSettled([k.invalidateQueries({queryKey:["users"]}),k.invalidateQueries({queryKey:["tickets"]})]),t("/agent/tickets")},onError:a=>Ke(a,s)})}function fi(s){return y.post("merge-users",s).then(t=>t.data)}function yi({mergee:s}){const{close:t,formId:a}=A(),n=ve({defaultValues:{mergee_id:s.id}}),i=pi(n),r=n.watch("user_id");return e.jsxs(Q,{children:[e.jsx(G,{children:e.jsx(c,{message:"Merge ':name' into another user",values:{name:s.display_name}})}),e.jsx(H,{children:e.jsx(ke,{id:a,form:n,onSubmit:l=>{i.mutate(l,{onSuccess:()=>t()})},children:e.jsx(Qe,{name:"user_id",endpoint:"normalized-models/user",label:e.jsx(c,{message:"User to merge into"}),placeholder:h("Select user"),description:e.jsx(c,{message:"':name' will be deleted and all data belonging to them will be merged into selected user.",values:{name:s.display_name}})})})}),e.jsxs(Z,{children:[e.jsx(g,{onClick:()=>t(),children:e.jsx(c,{message:"Cancel"})}),e.jsx(g,{type:"submit",variant:"flat",color:"primary",form:a,disabled:!r||i.isPending,children:e.jsx(c,{message:"Merge"})})]})]})}function bi(){var n;const{userId:s}=B(),t=wt(s,{with:["tags","secondary_emails","details","purchase_codes","bans","lastLogin"]}),a=(n=t.data)==null?void 0:n.user;return d.useEffect(()=>{Tt(["timezones","countries","localizations"])},[]),!t.isLoading&&!t.data?e.jsx(be,{query:t}):e.jsxs(Is,{name:"agent_customer_page",children:[e.jsx(Je,{element:Ds}),e.jsx(vi,{user:a}),e.jsx(_s,{children:e.jsx("main",{className:w("p-14 transition-opacity md:p-24",!a&&"opacity-0"),children:e.jsxs(d.Fragment,{children:[e.jsx(ki,{user:a}),e.jsx(wi,{})]})})})]})}function vi({user:s}){const{isMobileMode:t}=d.useContext(Yt);return e.jsx(We,{position:"left",size:"w-350",className:w("bg",t?"border-r p-12":"mt-8 py-24 pl-24"),overflow:"overflow-y-auto overflow-x-hidden compact-scrollbar",children:e.jsx(oi,{user:s})})}function ki({user:s}){var a,n;if(!s)return null;const t=(n=(a=s.bans)==null?void 0:a[0])==null?void 0:n.comment;return e.jsxs("header",{className:"mb-16 flex items-center",children:[e.jsxs("div",{className:"mr-auto flex items-center gap-14",children:[e.jsx(He,{user:s,size:"w-50 h-50",circle:!0}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold",children:s.display_name}),t&&e.jsx("div",{className:"text-sm text-danger",children:e.jsx(c,{message:"Suspended: :reason",values:{reason:t}})})]})]}),e.jsx(g,{variant:"outline",startIcon:e.jsx(ws,{}),size:"xs",className:"mx-12",elementType:F,to:`/agent/tickets/new?customer_id=${s.id}`,target:"_blank",children:e.jsx(c,{message:"New ticket"})}),e.jsxs(O,{children:[e.jsx(D,{variant:"outline",size:"xs",children:e.jsx(Lt,{})}),e.jsxs($,{children:[e.jsx(j,{value:"suspend",onSelected:()=>z($t,{user:s}),children:e.jsx(c,{message:"Suspend"})}),e.jsx(j,{value:"merge",onSelected:()=>z(yi,{mergee:s}),children:e.jsx(c,{message:"Merge into another user"})}),e.jsx(j,{value:"delete",onSelected:()=>z(Si,{user:s}),children:e.jsx(c,{message:"Delete"})})]})]})]})}function Si({user:s}){const t=gi(),{close:a}=A();return e.jsx(le,{isDanger:!0,title:e.jsx(c,{message:"Delete user"}),body:e.jsx(c,{message:"Are you sure you want to delete this user? This will also delete all tickets created by this user and can't be undone."}),onConfirm:()=>{t.mutate({userId:s.id},{onSuccess:()=>a()})},isLoading:t.isPending,confirm:e.jsx(c,{message:"Delete"})})}function wi(){const{userId:s}=B(),{pathname:t}=xs(),[a,n]=d.useState(()=>t.endsWith("searches")?1:0);return e.jsx("div",{className:"rounded border",children:e.jsxs(ks,{selectedTab:a,onTabChange:n,children:[e.jsxs(Ss,{children:[e.jsx(_e,{width:"min-w-132",elementType:F,to:Pe(s),replace:!0,children:e.jsx(c,{message:"Tickets"})}),e.jsx(_e,{width:"min-w-132",elementType:F,to:Pe(s,{tab:"searches"}),replace:!0,children:e.jsx(c,{message:"Searches"})})]}),e.jsx("div",{children:e.jsx(gs,{})})]})})}function Ti(){const[s,t]=q(),{userId:a}=B(),[n,i]=d.useState([]),r=Ee({userId:a,page:s.get("page")||1,perPage:s.get("perPage")??"",loader:"ticketTable"}),{data:l,fetchStatus:o,isLoading:u,isPlaceholderData:m}=r,v=(l==null?void 0:l.pagination.data)||[],p=o==="idle"&&v.length===0||!u&&!m&&v.length===0;return e.jsxs("div",{className:"relative",children:[e.jsx(Ue,{query:r}),e.jsx(Ge,{query:r,selectedTickets:n,onSelectionChange:i}),e.jsx(ee,{children:n.length&&e.jsx(Ye,{ticketIds:n,onActionCompleted:()=>i([])})}),p&&e.jsx(Me,{className:"mt-48",image:e.jsx(us,{src:js}),title:e.jsx(c,{message:"User has not created any tickets yet"})}),e.jsx(Fe,{query:r,onPageChange:S=>t(f=>(f.set("page",S.toString()),f)),onPerPageChange:S=>t(f=>(f.set("perPage",S.toString()),f))})]})}function Li(){const{userId:s}=B();return e.jsx(Bt,{description:e.jsx(c,{message:"This report shows what the user searched for recently."}),userId:s,orderBy:"last_seen"})}const Ci=[{path:"/",element:e.jsx(as,{to:"/agent/tickets",replace:!0})},{path:"/tickets",element:e.jsx(_a,{})},{path:"/tickets/new",element:e.jsx(ii,{})},{path:"/tickets/:ticketId",element:e.jsx(si,{})},{path:"/users/:userId",element:e.jsx(bi,{}),children:[{path:"",element:e.jsx(as,{to:"tickets",replace:!0})},{path:"tickets",element:e.jsx(Ti,{})},{path:"searches",element:e.jsx(Li,{})}]},{path:"/search",element:e.jsx(Ra,{}),children:[{path:"",element:e.jsx(ls,{})},{path:"tickets",element:e.jsx(ls,{})},{path:"users",element:e.jsx($a,{})},{path:"articles",element:e.jsx(Ka,{})}]},{path:"saved-replies",element:e.jsx(ni,{})},{path:"*",element:e.jsx(Nt,{})}];function zi(){return Ct(Ci)}export{zi as default};
//# sourceMappingURL=agent-routes-9d1d603d.js.map
