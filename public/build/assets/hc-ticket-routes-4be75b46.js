import{j as e,T as a,a3 as w,a4 as H,k as y,U as q,B as v,z as W,a2 as D,g as X,r as m,E as J,ai as Z,m as C,S as ee,y as K,bj as se,n as f,F as O,G as te,M as N,u as $,s as ae,a5 as ne,a6 as Q,t as ie,v as R,au as re,an as V,K as ce,al as oe,D as le,w as de,ae as me,O as G,b as U,i as ue,A as xe,aw as he,h as ge,aF as je,ax as pe,aH as E,aG as fe,X as ye,a1 as be}from"./main-e1cf0da5.js";import{H as P}from"./hc-routes-fe9d27a9.js";import{a as ke,S as ve,l as Se,m as Te,f as Ne,c as we,T as qe,I as Ce,u as Re,k as Pe}from"./use-create-ticket-a3cbaa90.js";import{T as Ie,D as _e,a as Fe,R as Y,A as Ae,F as Le,j as Be,x as M,g as ze}from"./reply-editor-6e29b1f9.js";import{s as Ee}from"./search-c4d1b146.js";import{B as I,a as x}from"./breadcrumb-1f306abe.js";import{R as Me}from"./Reply-ab6f7f18.js";import{u as He}from"./search-trigger-button-67999931.js";import{S as De}from"./section-helper-a8725bb8.js";import"./bullet-seprated-items-c343c4fa.js";import"./AttachFile-f1216a54.js";import"./Edit-49f7c482.js";const Ke=[{key:"subject",visibleInMode:"all",header:()=>e.jsx(a,{message:"Subject"}),body:s=>s.subject,width:"flex-3 min-w-200"},{key:"id",allowsSorting:!0,header:()=>e.jsx(a,{message:"Id"}),width:"w-90",body:s=>`#${s.id}`},{key:"Created",allowsSorting:!0,header:()=>e.jsx(a,{message:"Created"}),width:"w-144",body:s=>e.jsx(w,{date:s.created_at})},{key:"updated_at",allowsSorting:!0,header:()=>e.jsx(a,{message:"Last updated"}),width:"w-144",body:s=>e.jsx(w,{date:s.updated_at})},{key:"status",header:()=>e.jsx(a,{message:"Status"}),visibleInMode:"all",width:"w-80",body:s=>e.jsx("div",{className:"w-max",children:e.jsx(H,{size:"sm",color:s.closed_at?void 0:"primary",radius:"rounded-md",className:"font-medium capitalize",children:e.jsx(a,{message:s.status})})})}],Oe="1",$e="20";function Qe(){const s=y();return e.jsxs("div",{children:[e.jsx(q,{menuPosition:"header",children:e.jsx(P,{})}),e.jsxs("main",{className:"container mx-auto px-24 pb-48",children:[e.jsxs(I,{size:"sm",className:"mb-48 mt-34",children:[e.jsx(x,{onSelected:()=>s("/hc"),children:e.jsx(a,{message:"Help center"})}),e.jsx(x,{onSelected:()=>s("/hc/tickets"),children:e.jsx(a,{message:"Requests"})})]}),e.jsxs("div",{className:"mb-34 flex items-start justify-between gap-12",children:[e.jsx("h1",{className:"text-3xl font-semibold",children:e.jsx(a,{message:"My requests"})}),e.jsx(v,{elementType:W,to:"/hc/tickets/new",size:"sm",variant:"outline",children:e.jsx(a,{message:"New request"})})]}),e.jsx(Ve,{})]})]})}function Ve(){var b,k;const[s,n]=D(),{trans:t}=X(),i=m.useRef(null),c=y(),{user:l}=J(),o=ke({userId:l.id,query:s.get("query"),tagId:s.get("tagId"),page:s.get("page")||Oe,perPage:s.get("perPage")||$e}),h=((k=(b=o.data)==null?void 0:b.pagination)==null?void 0:k.data)||[],u=!!s.get("query")||!!s.get("tagId"),j=()=>{n(d=>{var g;return(g=i.current)!=null&&g.value?d.set("query",i.current.value):d.delete("query"),d})},S=h.length?e.jsxs(m.Fragment,{children:[e.jsx(Ie,{columns:Ke,data:h,enableSelection:!1,onAction:d=>c(`/hc/tickets/${d.id}`),cellHeight:"h-60"}),e.jsx(_e,{className:"mt-12",query:o,onPageChange:d=>n(g=>(g.set("page",d.toString()),g))})]}):e.jsx(Ge,{isFiltering:u});return e.jsxs(m.Fragment,{children:[e.jsxs("form",{className:"mb-34 items-end justify-between gap-24 md:flex",onSubmit:d=>{d.preventDefault(),j()},children:[e.jsx(Z,{className:"flex-auto max-md:mb-24",inputRef:i,defaultValue:s.get("query")||"",onBlur:()=>j(),placeholder:t(C("Search requests")),startAdornment:e.jsx(ee,{})}),e.jsx(Ue,{})]}),e.jsx(K,{initial:!1,mode:"wait",children:o.isLoading?e.jsx(Ye,{}):S})]})}function Ge({isFiltering:s}){return e.jsx(Fe,{isFiltering:s,size:"sm",className:"mt-48",image:Ee,title:e.jsx(a,{message:"You have not created any requests yet"}),filteringTitle:e.jsx(a,{message:"No requests match your search query or filters"})})}function Ue(){const[s,n]=D();return e.jsxs(se,{className:"flex-shrink-0 md:min-w-172",selectionMode:"single",selectedValue:s.get("tagId")||"",onSelectionChange:t=>{n(i=>(t?i.set("tagId",`${t}`):i.delete("tagId"),i))},children:[e.jsx(f,{value:"",children:e.jsx(a,{message:"All requests"})}),e.jsx(f,{value:"open",children:e.jsx(a,{message:"Open requests"})}),e.jsx(f,{value:"closed",children:e.jsx(a,{message:"Closed requests"})}),e.jsx(f,{value:"pending",children:e.jsx(a,{message:"Awaiting your reply"})})]})}function Ye(){return e.jsxs(O.div,{...te,children:[e.jsx(N,{size:"h-36",variant:"rect",className:"mb-12"}),e.jsx(N,{size:"h-54",variant:"rect",className:"mb-12"}),e.jsx(N,{size:"h-54",variant:"rect"})]},"skeletons")}function We(){const{ticketId:s}=$();return ae({mutationFn:n=>Xe({ticketId:s,...n}),onSuccess:async()=>{await ne.invalidateQueries({queryKey:["tickets"]}),Q(C("Reply submitted"))},onError:n=>ie(n)})}function Xe(s){var t;const n={body:s.body,attachments:(t=s.attachments)==null?void 0:t.map(i=>i.id)};return R.post(`tickets/${s.ticketId}/replies`,n).then(i=>i.data)}function Je(){const s=y();return e.jsxs("div",{children:[e.jsx(q,{menuPosition:"header",children:e.jsx(P,{})}),e.jsxs("div",{className:"container mx-auto px-12 pb-48 md:px-24",children:[e.jsxs(I,{size:"sm",className:"mb-34 mt-34 md:mb-48",children:[e.jsx(x,{onSelected:()=>s("/hc"),children:e.jsx(a,{message:"Help center"})}),e.jsx(x,{onSelected:()=>s("/hc/tickets"),children:e.jsx(a,{message:"Requests"})}),e.jsx(x,{children:e.jsx(a,{message:"Current ticket"})})]}),e.jsx("main",{children:e.jsx(Ze,{})})]})]})}function Ze(){const s=re(),[n,t]=m.useState(!1);return He("window","r",()=>t(!0)),e.jsx(m.Fragment,{children:s.data?e.jsxs(m.Fragment,{children:[s.data.ticket.status==="locked"&&e.jsx(De,{className:"mb-44 text-center",color:"danger",title:e.jsx(a,{message:"This ticket was locked due to inactivity. To reply, create a new ticket."})}),e.jsx(ss,{ticket:s.data.ticket,editorIsOpen:n,onOpenEditor:()=>t(!0)}),e.jsx(V,{children:n&&e.jsx(es,{onClose:()=>t(!1)})}),e.jsx(ts,{data:s.data})]}):e.jsx(ce,{query:s,loaderClassName:"absolute inset-0 m-auto"})})}function es({onClose:s}){const n=m.useRef(null),t=We(),[i,c]=m.useState([]);return e.jsx(Y,{isLoading:t.isPending,footerButtons:e.jsx(ve,{}),editorRef:n,className:"mb-24",attachments:i,onAttachmentsChange:l=>c(l),onSubmit:l=>t.mutate(l,{onSuccess:()=>s()})})}function ss({ticket:s,onOpenEditor:n,editorIsOpen:t}){return e.jsxs("div",{className:"mb-44",children:[e.jsxs("div",{className:"flex items-center gap-24",children:[e.jsxs("div",{className:"whitespace-nowrap text-muted max-md:hidden",children:[e.jsx(w,{date:s.created_at})," (",e.jsx(oe,{date:s.created_at,options:Se}),")"]}),e.jsxs("div",{className:"text-2xl md:ml-auto",children:["#",s.id]}),e.jsx(H,{size:"sm",color:s.closed_at?void 0:"primary",radius:"rounded",className:"min-w-60 font-bold capitalize",children:s.status})]}),e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx("h1",{className:"my-12 text-2xl",children:s.subject}),e.jsx(Te,{ticketRequestType:s.ticket_request_type})]}),e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx("div",{className:"mr-auto font-semibold max-md:hidden flex gap-4 items-center",children:e.jsx(Ne,{ticket:s,tagType:"category",size:"sm",radius:"rounded",className:""})}),!s.closed_at&&e.jsx(ns,{}),e.jsx(v,{size:"sm",variant:"outline",startIcon:e.jsx(Me,{}),disabled:t,onClick:()=>n(),children:e.jsx(a,{message:"Add a reply"})})]})]})}function ts({data:{ticket:s,replies:n}}){const t=we(s.id,n);return e.jsxs(m.Fragment,{children:[t.items.map(i=>{var l,o;const c=!t.hasNextPage&&i.id===((l=t.items.at(-1))==null?void 0:l.id);return e.jsx(qe,{className:"px-12",reply:i,isInitial:c,ticketRequestType:s.ticket_request_type,attachments:(o=i.attachments)!=null&&o.length?e.jsx(as,{attachments:i.attachments}):null},i.id)}),e.jsx(Ce,{query:t})]})}function as({attachments:s}){return e.jsx(Ae,{className:"mt-30 w-max",children:s.map((n,t)=>e.jsx(Le,{attachments:s,index:t},n.id))})}function ns(){const s=Re(),{ticketId:n}=$(),t=y();return e.jsxs(le,{type:"modal",children:[e.jsx(v,{size:"sm",variant:"outline",startIcon:e.jsx(de,{}),children:e.jsx(a,{message:"Mark as solved"})}),({close:i})=>e.jsx(me,{onConfirm:()=>{s.mutate({ids:[n],status:"closed"},{onSuccess:()=>{i(),Q(C("Ticked marked as solved")),t("/hc/tickets")}})},isLoading:s.isPending,title:e.jsx(a,{message:"Mark as solved"}),body:e.jsx(a,{message:"Are you sure you want to mark this ticket as solved?"}),confirm:e.jsx(a,{message:"Confirm"})})]})}function is(){return G({queryKey:["new-ticket-categories"],queryFn:()=>rs()})}function rs(){return R.get("ticket-categories",{params:{perPage:25,with:"categories",orderBy:"name",orderDir:"asc",filterByPurchases:!0,paginate:"simple"}}).then(s=>s.data)}function cs(){return G({queryKey:["new-ticket-request-type"],queryFn:()=>os()})}function os(){return R.get("ticket-request-type",{params:{perPage:25,with:"",orderBy:"name",orderDir:"asc",filterByPurchases:!1,paginate:"simple"}}).then(s=>s.data)}function _(){var n,t;return((t=(n=U().hc)==null?void 0:n.newTicket)==null?void 0:t.appearance)||{}}function ls({query:s,suggestionLog:n,hcCategoryIds:t}){const i=Be(),c=u=>{u.pagination.data.length&&n.current.push({term:u.query,results:u.pagination.data.map(j=>j.id),date:i.toAbsoluteString()})},{data:l}=ue(s,{perPage:5,categoryIds:t},{onSearch:c}),o=l==null?void 0:l.pagination.data,h=!!(o!=null&&o.length);return e.jsx(K,{children:e.jsxs(O.div,{variants:M.variants,transition:M.transition,initial:!1,animate:h?"open":"closed",children:[e.jsxs("div",{className:"mb-10 mt-24 text-xl font-semibold",children:[e.jsx(a,{message:"Were you looking for"}),":"]}),o==null?void 0:o.map(u=>e.jsx(xe,{article:u,className:"block py-10 text-sm text-primary",target:"_blank"},u.id))]},"drawer")})}function ds(){const s=y(),n=_(),t=is(),i=cs(),{envato:c}=U();return e.jsxs("div",{children:[e.jsx(q,{menuPosition:"header",children:e.jsx(P,{})}),e.jsxs("div",{className:"container mx-auto px-12 pb-48 md:px-24",children:[e.jsxs(I,{size:"sm",className:"mb-34 mt-34 md:mb-48",children:[e.jsx(x,{onSelected:()=>s("/hc"),children:e.jsx(a,{message:"Help center"})}),e.jsx(x,{onSelected:()=>s("/hc/tickets"),children:e.jsx(a,{message:"Requests"})}),e.jsx(x,{children:e.jsx(a,{message:"New request"})})]}),e.jsxs("div",{className:"flex items-stretch gap-44",children:[e.jsxs("main",{className:"flex-auto",children:[e.jsx("h1",{className:"mb-34 mt-14 text-3xl font-light",children:e.jsx(a,{message:n.title})}),t.error&&c.enable&&c.require_purchase_code&&e.jsx(hs,{}),t.data&&i.data?e.jsx(ms,{ticketCategories:t.data.pagination.data,ticketRequestTypes:i.data.pagination.data}):null]}),e.jsx(us,{})]})]})]})}function ms({ticketCategories:s,ticketRequestTypes:n}){var A,L,B,z;const t=_(),i=y(),c=he({defaultValues:{category_id:(A=s[0])==null?void 0:A.id,ticket_request_type:(L=n[0])==null?void 0:L.id}}),l=(B=c.formState.errors.body)==null?void 0:B.message,o=Pe(c),h=m.useRef(null),[u,j]=m.useState([]),S=c.watch("subject"),b=(z=s.find(r=>c.watch("category_id")==r.id))==null?void 0:z.categories.map(r=>r.id),k=ge(),d=m.useRef([]),g=c.watch("category_id"),p=s.find(r=>r.id==g),F=()=>{o.mutate({...c.getValues(),body:ze(h)||"",attachments:u.map(r=>r.id),suggestionLog:d.current},{onSuccess:()=>{k.updateLastSearch({createdTicket:!0}),i("/hc/tickets")}})},T=je();return e.jsxs(pe,{form:c,onSubmit:()=>F(),onBeforeSubmit:()=>c.clearErrors(),children:[e.jsx(E,{name:"category_id",label:e.jsx(a,{message:t.categoryLabel}),selectionMode:"single",className:"mb-24",errorMessage:p&&p.support_expired&&e.jsx(a,{message:"Your support for this item has expired. <a>Click here to renew</a>",values:{a:r=>e.jsx("a",{href:"https://codecanyon.net/downloads",target:"_blank",rel:"noreferrer",className:"font-bold underline",children:r})}}),children:s.map(r=>e.jsx(f,{value:r.id,children:r.display_name||r.name},r.id))}),e.jsx(E,{name:"ticket_request_type",label:e.jsx(a,{message:"Request Type"}),selectionMode:"single",className:"mb-24",children:n.map(r=>e.jsx(f,{value:r.id,children:r.display_name||r.name},r.id))}),e.jsx(fe,{name:"subject",label:e.jsx(a,{message:t.subjectLabel})}),e.jsx(ls,{query:S,suggestionLog:d,hcCategoryIds:b}),e.jsxs("div",{className:"my-24",children:[e.jsx("div",{className:T.label,children:e.jsx(a,{message:t.descriptionLabel})}),(p==null?void 0:p.description_ticket_page)&&e.jsx("div",{className:`[&_a]:underline ${T.label}`,children:e.jsx("div",{dangerouslySetInnerHTML:{__html:p.description_ticket_page}})}),e.jsx(V,{children:e.jsx(Y,{autoFocus:!1,minHeight:"min-h-[300px]",isLoading:o.isPending,editorRef:h,attachments:u,onAttachmentsChange:r=>j(r),onSubmit:()=>F()})}),l&&e.jsx("div",{className:T.error,children:l})]}),e.jsx(v,{variant:"flat",color:"primary",type:"submit",disabled:o.isPending,children:e.jsx(a,{message:t.submitButtonText})})]})}function us(){var n;const s=_();return e.jsxs("aside",{className:"w-500 border-l px-40 max-md:hidden",children:[e.jsx("h2",{className:"mb-34 text-xl font-medium",children:e.jsx(a,{message:s.sidebarTitle})}),(n=s.sidebarTips)==null?void 0:n.map((t,i)=>e.jsx(xs,{title:e.jsx(a,{message:t.title}),children:e.jsx(a,{message:t.content})},i))]})}function xs({title:s,children:n}){return e.jsxs("div",{className:"mb-30",children:[e.jsx("h3",{className:"text-lg font-medium",children:s}),e.jsx("p",{children:n})]})}function hs(){return e.jsx("div",{className:"text-sm text-danger",children:e.jsx(a,{message:"There was an issue fetching your purchase codes from envato. Try to logout and use 'login with envato' button."})})}const gs=[{path:"/",element:e.jsx(Qe,{})},{path:"/new",element:e.jsx(ds,{})},{path:":ticketId",element:e.jsx(Je,{})},{path:"*",element:e.jsx(be,{})}];function Cs(){return ye(gs)}export{Cs as default};
//# sourceMappingURL=hc-ticket-routes-4be75b46.js.map
