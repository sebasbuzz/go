import{j as e,T as n,a3 as N,a4 as z,k as p,U as w,B as S,z as $,a2 as B,g as G,r as l,E as U,ai as Y,m as T,S as W,y as E,bj as X,n as y,F as H,G as J,M as k,u as M,s as Z,a5 as ee,a6 as D,t as se,v as O,au as te,an as K,K as ae,al as ne,D as ie,w as re,ae as ce,O as oe,b as Q,i as le,A as de,aw as me,h as ue,aF as xe,ax as he,aH as ge,aG as je,X as pe,a1 as fe}from"./main-ab90dad4.js";import{H as C}from"./hc-routes-8dc75513.js";import{a as ye,S as be,l as Se,f as ve,c as ke,T as Ne,I as we,u as Te,k as Ce}from"./use-create-ticket-c29bee7b.js";import{T as Ie,D as Pe,a as qe,R as V,A as Re,F as Fe,j as Ae,x as _,g as Le}from"./reply-editor-af50917c.js";import{s as _e}from"./search-94d0051d.js";import{B as I,a as h}from"./breadcrumb-63d79ce0.js";import{R as ze}from"./Reply-123b3d2d.js";import{u as Be}from"./search-trigger-button-38b843c6.js";import{S as Ee}from"./section-helper-801264aa.js";import"./bullet-seprated-items-98342392.js";import"./AttachFile-82aadb1a.js";import"./Edit-3e5a7805.js";const He=[{key:"subject",visibleInMode:"all",header:()=>e.jsx(n,{message:"Subject"}),body:s=>s.subject,width:"flex-3 min-w-200"},{key:"id",allowsSorting:!0,header:()=>e.jsx(n,{message:"Id"}),width:"w-90",body:s=>`#${s.id}`},{key:"Created",allowsSorting:!0,header:()=>e.jsx(n,{message:"Created"}),width:"w-144",body:s=>e.jsx(N,{date:s.created_at})},{key:"updated_at",allowsSorting:!0,header:()=>e.jsx(n,{message:"Last updated"}),width:"w-144",body:s=>e.jsx(N,{date:s.updated_at})},{key:"status",header:()=>e.jsx(n,{message:"Status"}),visibleInMode:"all",width:"w-80",body:s=>e.jsx("div",{className:"w-max",children:e.jsx(z,{size:"sm",color:s.closed_at?void 0:"primary",radius:"rounded-md",className:"font-medium capitalize",children:e.jsx(n,{message:s.status})})})}],Me="1",De="20";function Oe(){const s=p();return e.jsxs("div",{children:[e.jsx(w,{menuPosition:"header",children:e.jsx(C,{})}),e.jsxs("main",{className:"container mx-auto px-24 pb-48",children:[e.jsxs(I,{size:"sm",className:"mb-48 mt-34",children:[e.jsx(h,{onSelected:()=>s("/hc"),children:e.jsx(n,{message:"Help center"})}),e.jsx(h,{onSelected:()=>s("/hc/tickets"),children:e.jsx(n,{message:"Requests"})})]}),e.jsxs("div",{className:"mb-34 flex items-start justify-between gap-12",children:[e.jsx("h1",{className:"text-3xl font-semibold",children:e.jsx(n,{message:"My requests"})}),e.jsx(S,{elementType:$,to:"/hc/tickets/new",size:"sm",variant:"outline",children:e.jsx(n,{message:"New request"})})]}),e.jsx(Ke,{})]})]})}function Ke(){var b,f;const[s,t]=B(),{trans:a}=G(),i=l.useRef(null),m=p(),{user:r}=U(),c=ye({userId:r.id,query:s.get("query"),tagId:s.get("tagId"),page:s.get("page")||Me,perPage:s.get("perPage")||De}),g=((f=(b=c.data)==null?void 0:b.pagination)==null?void 0:f.data)||[],u=!!s.get("query")||!!s.get("tagId"),j=()=>{t(d=>{var x;return(x=i.current)!=null&&x.value?d.set("query",i.current.value):d.delete("query"),d})},v=g.length?e.jsxs(l.Fragment,{children:[e.jsx(Ie,{columns:He,data:g,enableSelection:!1,onAction:d=>m(`/hc/tickets/${d.id}`),cellHeight:"h-60"}),e.jsx(Pe,{className:"mt-12",query:c,onPageChange:d=>t(x=>(x.set("page",d.toString()),x))})]}):e.jsx(Qe,{isFiltering:u});return e.jsxs(l.Fragment,{children:[e.jsxs("form",{className:"mb-34 items-end justify-between gap-24 md:flex",onSubmit:d=>{d.preventDefault(),j()},children:[e.jsx(Y,{className:"flex-auto max-md:mb-24",inputRef:i,defaultValue:s.get("query")||"",onBlur:()=>j(),placeholder:a(T("Search requests")),startAdornment:e.jsx(W,{})}),e.jsx(Ve,{})]}),e.jsx(E,{initial:!1,mode:"wait",children:c.isLoading?e.jsx($e,{}):v})]})}function Qe({isFiltering:s}){return e.jsx(qe,{isFiltering:s,size:"sm",className:"mt-48",image:_e,title:e.jsx(n,{message:"You have not created any requests yet"}),filteringTitle:e.jsx(n,{message:"No requests match your search query or filters"})})}function Ve(){const[s,t]=B();return e.jsxs(X,{className:"flex-shrink-0 md:min-w-172",selectionMode:"single",selectedValue:s.get("tagId")||"",onSelectionChange:a=>{t(i=>(a?i.set("tagId",`${a}`):i.delete("tagId"),i))},children:[e.jsx(y,{value:"",children:e.jsx(n,{message:"All requests"})}),e.jsx(y,{value:"open",children:e.jsx(n,{message:"Open requests"})}),e.jsx(y,{value:"closed",children:e.jsx(n,{message:"Closed requests"})}),e.jsx(y,{value:"pending",children:e.jsx(n,{message:"Awaiting your reply"})})]})}function $e(){return e.jsxs(H.div,{...J,children:[e.jsx(k,{size:"h-36",variant:"rect",className:"mb-12"}),e.jsx(k,{size:"h-54",variant:"rect",className:"mb-12"}),e.jsx(k,{size:"h-54",variant:"rect"})]},"skeletons")}function Ge(){const{ticketId:s}=M();return Z({mutationFn:t=>Ue({ticketId:s,...t}),onSuccess:async()=>{await ee.invalidateQueries({queryKey:["tickets"]}),D(T("Reply submitted"))},onError:t=>se(t)})}function Ue(s){var a;const t={body:s.body,attachments:(a=s.attachments)==null?void 0:a.map(i=>i.id)};return O.post(`tickets/${s.ticketId}/replies`,t).then(i=>i.data)}function Ye(){const s=p();return e.jsxs("div",{children:[e.jsx(w,{menuPosition:"header",children:e.jsx(C,{})}),e.jsxs("div",{className:"container mx-auto px-12 pb-48 md:px-24",children:[e.jsxs(I,{size:"sm",className:"mb-34 mt-34 md:mb-48",children:[e.jsx(h,{onSelected:()=>s("/hc"),children:e.jsx(n,{message:"Help center"})}),e.jsx(h,{onSelected:()=>s("/hc/tickets"),children:e.jsx(n,{message:"Requests"})}),e.jsx(h,{children:e.jsx(n,{message:"Current ticket"})})]}),e.jsx("main",{children:e.jsx(We,{})})]})]})}function We(){const s=te(),[t,a]=l.useState(!1);return Be("window","r",()=>a(!0)),e.jsx(l.Fragment,{children:s.data?e.jsxs(l.Fragment,{children:[s.data.ticket.status==="locked"&&e.jsx(Ee,{className:"mb-44 text-center",color:"danger",title:e.jsx(n,{message:"This ticket was locked due to inactivity. To reply, create a new ticket."})}),e.jsx(Je,{ticket:s.data.ticket,editorIsOpen:t,onOpenEditor:()=>a(!0)}),e.jsx(K,{children:t&&e.jsx(Xe,{onClose:()=>a(!1)})}),e.jsx(Ze,{data:s.data})]}):e.jsx(ae,{query:s,loaderClassName:"absolute inset-0 m-auto"})})}function Xe({onClose:s}){const t=l.useRef(null),a=Ge(),[i,m]=l.useState([]);return e.jsx(V,{isLoading:a.isPending,footerButtons:e.jsx(be,{}),editorRef:t,className:"mb-24",attachments:i,onAttachmentsChange:r=>m(r),onSubmit:r=>a.mutate(r,{onSuccess:()=>s()})})}function Je({ticket:s,onOpenEditor:t,editorIsOpen:a}){return e.jsxs("div",{className:"mb-44",children:[e.jsxs("div",{className:"flex items-center gap-24",children:[e.jsxs("div",{className:"whitespace-nowrap text-muted max-md:hidden",children:[e.jsx(N,{date:s.created_at})," (",e.jsx(ne,{date:s.created_at,options:Se}),")"]}),e.jsxs("div",{className:"text-2xl md:ml-auto",children:["#",s.id]}),e.jsx(z,{size:"sm",color:s.closed_at?void 0:"primary",radius:"rounded",className:"min-w-60 font-bold capitalize",children:s.status})]}),e.jsx("h1",{className:"my-12 text-2xl",children:s.subject}),e.jsxs("div",{className:"flex items-center gap-12",children:[e.jsx(ve,{ticket:s,tagType:"category",size:"sm",radius:"rounded",className:"mr-auto font-semibold max-md:hidden"}),!s.closed_at&&e.jsx(ss,{}),e.jsx(S,{size:"sm",variant:"outline",startIcon:e.jsx(ze,{}),disabled:a,onClick:()=>t(),children:e.jsx(n,{message:"Add a reply"})})]})]})}function Ze({data:{ticket:s,replies:t}}){const a=ke(s.id,t);return e.jsxs(l.Fragment,{children:[a.items.map(i=>{var r,c;const m=!a.hasNextPage&&i.id===((r=a.items.at(-1))==null?void 0:r.id);return e.jsx(Ne,{className:"px-12",reply:i,isInitial:m,attachments:(c=i.attachments)!=null&&c.length?e.jsx(es,{attachments:i.attachments}):null},i.id)}),e.jsx(we,{query:a})]})}function es({attachments:s}){return e.jsx(Re,{className:"mt-30 w-max",children:s.map((t,a)=>e.jsx(Fe,{attachments:s,index:a},t.id))})}function ss(){const s=Te(),{ticketId:t}=M(),a=p();return e.jsxs(ie,{type:"modal",children:[e.jsx(S,{size:"sm",variant:"outline",startIcon:e.jsx(re,{}),children:e.jsx(n,{message:"Mark as solved"})}),({close:i})=>e.jsx(ce,{onConfirm:()=>{s.mutate({ids:[t],status:"closed"},{onSuccess:()=>{i(),D(T("Ticked marked as solved")),a("/hc/tickets")}})},isLoading:s.isPending,title:e.jsx(n,{message:"Mark as solved"}),body:e.jsx(n,{message:"Are you sure you want to mark this ticket as solved?"}),confirm:e.jsx(n,{message:"Confirm"})})]})}function ts(){return oe({queryKey:["new-ticket-categories"],queryFn:()=>as()})}function as(){return O.get("ticket-categories",{params:{perPage:25,with:"categories",orderBy:"name",orderDir:"asc",filterByPurchases:!0,paginate:"simple"}}).then(s=>s.data)}function P(){var t,a;return((a=(t=Q().hc)==null?void 0:t.newTicket)==null?void 0:a.appearance)||{}}function ns({query:s,suggestionLog:t,hcCategoryIds:a}){const i=Ae(),m=u=>{u.pagination.data.length&&t.current.push({term:u.query,results:u.pagination.data.map(j=>j.id),date:i.toAbsoluteString()})},{data:r}=le(s,{perPage:5,categoryIds:a},{onSearch:m}),c=r==null?void 0:r.pagination.data,g=!!(c!=null&&c.length);return e.jsx(E,{children:e.jsxs(H.div,{variants:_.variants,transition:_.transition,initial:!1,animate:g?"open":"closed",children:[e.jsxs("div",{className:"mb-10 mt-24 text-xl font-semibold",children:[e.jsx(n,{message:"Were you looking for"}),":"]}),c==null?void 0:c.map(u=>e.jsx(de,{article:u,className:"block py-10 text-sm text-primary",target:"_blank"},u.id))]},"drawer")})}function is(){const s=p(),t=P(),a=ts(),{envato:i}=Q();return e.jsxs("div",{children:[e.jsx(w,{menuPosition:"header",children:e.jsx(C,{})}),e.jsxs("div",{className:"container mx-auto px-12 pb-48 md:px-24",children:[e.jsxs(I,{size:"sm",className:"mb-34 mt-34 md:mb-48",children:[e.jsx(h,{onSelected:()=>s("/hc"),children:e.jsx(n,{message:"Help center"})}),e.jsx(h,{onSelected:()=>s("/hc/tickets"),children:e.jsx(n,{message:"Requests"})}),e.jsx(h,{children:e.jsx(n,{message:"New request"})})]}),e.jsxs("div",{className:"flex items-stretch gap-44",children:[e.jsxs("main",{className:"flex-auto",children:[e.jsx("h1",{className:"mb-34 mt-14 text-3xl font-light",children:e.jsx(n,{message:t.title})}),a.error&&i.enable&&i.require_purchase_code&&e.jsx(ls,{}),a.data?e.jsx(rs,{ticketCategories:a.data.pagination.data}):null]}),e.jsx(cs,{})]})]})]})}function rs({ticketCategories:s}){var F,A,L;const t=P(),a=p(),i=me({defaultValues:{category_id:(F=s[0])==null?void 0:F.id}}),m=(A=i.formState.errors.body)==null?void 0:A.message,r=Ce(i),c=l.useRef(null),[g,u]=l.useState([]),j=i.watch("subject"),v=(L=s.find(o=>i.watch("category_id")==o.id))==null?void 0:L.categories.map(o=>o.id),b=ue(),f=l.useRef([]),d=i.watch("category_id"),x=s.find(o=>o.id==d),q=()=>{r.mutate({...i.getValues(),body:Le(c)||"",attachments:g.map(o=>o.id),suggestionLog:f.current},{onSuccess:()=>{b.updateLastSearch({createdTicket:!0}),a("/hc/tickets")}})},R=xe();return e.jsxs(he,{form:i,onSubmit:()=>q(),onBeforeSubmit:()=>i.clearErrors(),children:[e.jsx(ge,{name:"category_id",label:e.jsx(n,{message:t.categoryLabel}),selectionMode:"single",className:"mb-24",errorMessage:x&&x.support_expired&&e.jsx(n,{message:"Your support for this item has expired. <a>Click here to renew</a>",values:{a:o=>e.jsx("a",{href:"https://codecanyon.net/downloads",target:"_blank",rel:"noreferrer",className:"font-bold underline",children:o})}}),children:s.map(o=>e.jsx(y,{value:o.id,children:o.display_name||o.name},o.id))}),e.jsx(je,{name:"subject",label:e.jsx(n,{message:t.subjectLabel})}),e.jsx(ns,{query:j,suggestionLog:f,hcCategoryIds:v}),e.jsxs("div",{className:"my-24",children:[e.jsx("div",{className:R.label,children:e.jsx(n,{message:t.descriptionLabel})}),e.jsx(K,{children:e.jsx(V,{autoFocus:!1,minHeight:"min-h-[300px]",isLoading:r.isPending,editorRef:c,attachments:g,onAttachmentsChange:o=>u(o),onSubmit:()=>q()})}),m&&e.jsx("div",{className:R.error,children:m})]}),e.jsx(S,{variant:"flat",color:"primary",type:"submit",disabled:r.isPending,children:e.jsx(n,{message:t.submitButtonText})})]})}function cs(){var t;const s=P();return e.jsxs("aside",{className:"w-500 border-l px-40 max-md:hidden",children:[e.jsx("h2",{className:"mb-34 text-xl font-medium",children:e.jsx(n,{message:s.sidebarTitle})}),(t=s.sidebarTips)==null?void 0:t.map((a,i)=>e.jsx(os,{title:e.jsx(n,{message:a.title}),children:e.jsx(n,{message:a.content})},i))]})}function os({title:s,children:t}){return e.jsxs("div",{className:"mb-30",children:[e.jsx("h3",{className:"text-lg font-medium",children:s}),e.jsx("p",{children:t})]})}function ls(){return e.jsx("div",{className:"text-sm text-danger",children:e.jsx(n,{message:"There was an issue fetching your purchase codes from envato. Try to logout and use 'login with envato' button."})})}const ds=[{path:"/",element:e.jsx(Oe,{})},{path:"/new",element:e.jsx(is,{})},{path:":ticketId",element:e.jsx(Ye,{})},{path:"*",element:e.jsx(fe,{})}];function ks(){return pe(ds)}export{ks as default};
//# sourceMappingURL=hc-ticket-routes-909add96.js.map
